<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wiki - Weatheraintbad</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto Serif SC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* ==================== å…¨å±€æ ·å¼ ==================== */

        /* Wikié¡µé¢ç‰¹å®šæ ·å¼ */
        .doc-manager {
            min-height: 100vh;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%); /* é¡µé¢èƒŒæ™¯æ¸å˜é¢œè‰² */
            position: relative;
            overflow: hidden;
        }

        .doc-manager::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 50%, rgba(250, 167, 85, 0.05) 0%, transparent 70%); /* èƒŒæ™¯å…‰æ™•æ•ˆæœé¢œè‰² */
            z-index: 0;
        }

        .doc-content {
            position: relative;
            z-index: 1;
            width: 100%;
            padding: 85px 0 60px; /* è°ƒæ•´é¡¶éƒ¨è·ç¦»ï¼Œä¸ä¾§è¾¹æ ä¿æŒä¸€è‡´ */
        }

        /* é¡µé¢å¸ƒå±€å®¹å™¨ */
        .doc-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        /* ==================== é¡µé¢æ ‡é¢˜ ==================== */
        .doc-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3rem;
        }

        .doc-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color); /* é¡µé¢æ ‡é¢˜é¢œè‰² */
            font-family: 'Noto Serif SC', 'Times New Roman', serif;
        }

        /* ==================== æŒ‰é’®æ ·å¼ ==================== */

        /* æ–°å»ºæŒ‰é’® */
        .btn-new {
            background: linear-gradient(135deg, var(--accent-color), #ff9a3c); /* æŒ‰é’®æ¸å˜èƒŒæ™¯é¢œè‰² */
            color: white; /* æŒ‰é’®æ–‡å­—é¢œè‰² */
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(250, 167, 85, 0.3); /* æŒ‰é’®é˜´å½±é¢œè‰² */
        }

        .btn-new:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(250, 167, 85, 0.4); /* æŒ‰é’®æ‚¬åœæ—¶é˜´å½±é¢œè‰² */
        }

        .btn-new:active {
            transform: translateY(0);
        }

        /* ==================== æ–‡æ¡£åˆ—è¡¨ ==================== */
        .doc-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .doc-item {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05)); /* æ–‡æ¡£å¡ç‰‡èƒŒæ™¯é¢œè‰² */
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1); /* æ–‡æ¡£å¡ç‰‡è¾¹æ¡†é¢œè‰² */
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .doc-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent); /* å¡ç‰‡hoveræ—¶çš„å…‰æ•ˆé¢œè‰² */
            transition: left 0.6s;
        }

        .doc-item:hover::before {
            left: 100%;
        }

        .doc-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15); /* å¡ç‰‡hoveræ—¶çš„é˜´å½±é¢œè‰² */
            border-color: rgba(250, 167, 85, 0.3); /* å¡ç‰‡hoveræ—¶çš„è¾¹æ¡†é¢œè‰² */
        }

        .doc-item-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color); /* æ–‡æ¡£æ ‡é¢˜é¢œè‰² */
            margin-bottom: 0.5rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .doc-item-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: var(--secondary-color); /* æ–‡æ¡£å…ƒä¿¡æ¯é¢œè‰² */
            opacity: 0.7;
        }

        /* ==================== ä¾§è¾¹å¯¼èˆªæ  ==================== */
        .toc-container {
            position: fixed;
            top: 100px; /* ä¸å¯¼èˆªæ é«˜åº¦ä¸€è‡´ */
            left: 2rem; /* ä¸é¡µé¢å¸ƒå±€å®¹å™¨çš„å·¦è¾¹è·å¯¹é½ */
            width: 250px;
            height: calc(97.5vh - 100px); /* é¡µé¢é«˜åº¦ - å¯¼èˆªæ é«˜åº¦ */
            overflow-y: auto; /* æ·»åŠ å‚ç›´æ»šåŠ¨ */
            overflow-x: hidden; /* éšè—æ°´å¹³æ»šåŠ¨ */
            background: rgba(255, 255, 255, 0.1); /* ä¸ç¼–è¾‘æ¡†èƒŒæ™¯ç›¸åŒ */
            border: 1px solid rgba(255, 255, 255, 0.2); /* ä¸ç¼–è¾‘æ¡†è¾¹æ¡†ç›¸åŒ */
            border-radius: 12px; /* ä¸ç¼–è¾‘æ¡†è¾¹æ¡†åŠå¾„ç›¸åŒ */
            padding: 1.5rem; /* ä¸ç¼–è¾‘æ¡†å†…è¾¹è·ç›¸åŒ */
            box-shadow: var(--shadow-md);
            z-index: 100;
            display: none; /* é»˜è®¤éšè— */
            border-top: none; /* å»æ‰é¡¶éƒ¨è¾¹æ¡†ï¼Œä¸å¯¼èˆªæ ç›¸è¿ */
        }

        .toc-container.show {
            display: block;
        }

        .toc-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        .toc-list {
            list-style: none;
            padding-left: 0;
        }

        .toc-item {
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .toc-item:hover {
            color: var(--accent-color);
        }

        .toc-item h1 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .toc-item h2 {
            font-size: 1rem;
            font-weight: 500;
            color: var(--primary-color);
            padding-left: 1rem;
        }

        .toc-item h3 {
            font-size: 0.9rem;
            font-weight: 400;
            color: var(--secondary-color);
            padding-left: 2rem;
        }

        /* ==================== ç¼–è¾‘å™¨é¡µé¢ ==================== */
        .editor-container {
            max-width: 900px;
            margin: 0 auto;
            margin-left: 258px; /* å‡å°ä¾§è¾¹å¯¼èˆªæ ä¸ç¼–è¾‘æ¡†ä¹‹é—´çš„è·ç¦» */
        }

        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem; /* å‡å°æ ‡é¢˜åŒºåŸŸä¸å†…å®¹æ¡†ä¹‹é—´çš„è·ç¦» */
        }

        .editor-title-container {
            flex: 1;
            margin-right: 2rem;
        }

        .editor-title-input {
            width: 100%;
            background: transparent;
            border: none;
            color: var(--primary-color); /* ç¼–è¾‘å™¨æ ‡é¢˜é¢œè‰² */
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 700;
            font-family: 'Times New Roman', 'Noto Serif SC', Times, serif;
            line-height: 1.1;
            letter-spacing: -2px;
            padding: 0;
            margin: 0;
        }

        .editor-title-input::placeholder {
            color: var(--secondary-color); /* ç¼–è¾‘å™¨æ ‡é¢˜å ä½ç¬¦é¢œè‰² */
            opacity: 0.5;
        }

        .editor-title-input:focus {
            outline: none;
        }

        .editor-controls {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .btn-back {
            background: rgba(255, 255, 255, 0.1); /* è¿”å›æŒ‰é’®èƒŒæ™¯é¢œè‰² */
            color: var(--primary-color); /* è¿”å›æŒ‰é’®æ–‡å­—é¢œè‰² */
            border: 1px solid rgba(255, 255, 255, 0.2); /* è¿”å›æŒ‰é’®è¾¹æ¡†é¢œè‰² */
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-back:hover {
            background: rgba(255, 255, 255, 0.2); /* è¿”å›æŒ‰é’®hoverèƒŒæ™¯é¢œè‰² */
        }

        /* åˆ é™¤æŒ‰é’® */
        .btn-delete {
            background: rgba(255, 82, 82, 0.1); /* åˆ é™¤æŒ‰é’®èƒŒæ™¯é¢œè‰² */
            color: #ff5252; /* åˆ é™¤æŒ‰é’®æ–‡å­—é¢œè‰² */
            border: 1px solid rgba(255, 82, 82, 0.3); /* åˆ é™¤æŒ‰é’®è¾¹æ¡†é¢œè‰² */
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-delete:hover {
            background: rgba(255, 82, 82, 0.2); /* åˆ é™¤æŒ‰é’®hoverèƒŒæ™¯é¢œè‰² */
            border-color: rgba(255, 82, 82, 0.5); /* åˆ é™¤æŒ‰é’®hoverè¾¹æ¡†é¢œè‰² */
        }

        /* åˆ†äº«æŒ‰é’® */
        .btn-share {
            background: rgba(76, 175, 80, 0.1); /* åˆ†äº«æŒ‰é’®èƒŒæ™¯é¢œè‰² */
            color: #4caf50; /* åˆ†äº«æŒ‰é’®æ–‡å­—é¢œè‰² */
            border: 1px solid rgba(76, 175, 80, 0.3); /* åˆ†äº«æŒ‰é’®è¾¹æ¡†é¢œè‰² */
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-share:hover {
            background: rgba(76, 175, 80, 0.2); /* åˆ†äº«æŒ‰é’®hoverèƒŒæ™¯é¢œè‰² */
            border-color: rgba(76, 175, 80, 0.5); /* åˆ†äº«æŒ‰é’®hoverè¾¹æ¡†é¢œè‰² */
        }

        /* å‘å¸ƒæŒ‰é’® */
        .btn-publish {
            background: rgba(250, 167, 85, 0.1); /* å‘å¸ƒæŒ‰é’®èƒŒæ™¯é¢œè‰² */
            color: var(--accent-color); /* å‘å¸ƒæŒ‰é’®æ–‡å­—é¢œè‰² */
            border: 1px solid rgba(250, 167, 85, 0.3); /* å‘å¸ƒæŒ‰é’®è¾¹æ¡†é¢œè‰² */
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-publish:hover {
            background: rgba(250, 167, 85, 0.2); /* å‘å¸ƒæŒ‰é’®hoverèƒŒæ™¯é¢œè‰² */
            border-color: rgba(250, 167, 85, 0.5); /* å‘å¸ƒæŒ‰é’®hoverè¾¹æ¡†é¢œè‰² */
        }

        /* å·²å‘å¸ƒçŠ¶æ€çš„æŒ‰é’® */
        .btn-publish.published {
            background: rgba(255, 82, 82, 0.1); /* å·²å‘å¸ƒçŠ¶æ€æŒ‰é’®èƒŒæ™¯é¢œè‰² */
            color: #ff5252; /* å·²å‘å¸ƒçŠ¶æ€æŒ‰é’®æ–‡å­—é¢œè‰² */
            border: 1px solid rgba(255, 82, 82, 0.3); /* å·²å‘å¸ƒçŠ¶æ€æŒ‰é’®è¾¹æ¡†é¢œè‰² */
        }

        .btn-publish.published:hover {
            background: rgba(255, 82, 82, 0.2); /* å·²å‘å¸ƒçŠ¶æ€æŒ‰é’®hoverèƒŒæ™¯é¢œè‰² */
            border-color: rgba(255, 82, 82, 0.5); /* å·²å‘å¸ƒçŠ¶æ€æŒ‰é’®hoverè¾¹æ¡†é¢œè‰² */
        }

        /* ä¿å­˜æŒ‰é’® */
        .btn-save {
            background: linear-gradient(135deg, var(--accent-color), #ff9a3c); /* ä¿å­˜æŒ‰é’®æ¸å˜èƒŒæ™¯é¢œè‰² */
            color: white; /* ä¿å­˜æŒ‰é’®æ–‡å­—é¢œè‰² */
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(250, 167, 85, 0.3); /* ä¿å­˜æŒ‰é’®é˜´å½±é¢œè‰² */
        }

        .btn-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(250, 167, 85, 0.4); /* ä¿å­˜æŒ‰é’®hoveré˜´å½±é¢œè‰² */
        }

        /* æ¨¡å¼åˆ‡æ¢æŒ‰é’®å®¹å™¨ */
        #mode-buttons {
            display: none;
            gap: 0.5rem;
            align-items: center;
        }

        /* æ¨¡å¼åˆ‡æ¢æŒ‰é’® */
        .mode-btn {
            background: transparent;
            border: 1px solid var(--border-color); /* æ¨¡å¼æŒ‰é’®è¾¹æ¡†é¢œè‰² */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            color: var(--secondary-color); /* æ¨¡å¼æŒ‰é’®é»˜è®¤é¢œè‰² */
            padding: 0;
        }

        .mode-btn:hover {
            color: var(--accent-color); /* æ¨¡å¼æŒ‰é’®hoveré¢œè‰² */
            border-color: var(--accent-color); /* æ¨¡å¼æŒ‰é’®hoverè¾¹æ¡†é¢œè‰² */
        }

        .mode-btn.active {
            color: var(--accent-color); /* æ¨¡å¼æŒ‰é’®æ¿€æ´»çŠ¶æ€é¢œè‰² */
            border-color: var(--accent-color); /* æ¨¡å¼æŒ‰é’®æ¿€æ´»çŠ¶æ€è¾¹æ¡†é¢œè‰² */
        }

        .mode-btn svg {
            transition: all 0.3s ease;
        }

        .mode-btn.active svg {
            transform: scale(1.1);
        }

        /* ==================== ç¼–è¾‘å™¨åŒºåŸŸ ==================== */
        .editor-area {
            background: rgba(255, 255, 255, 0.1); /* ç¼–è¾‘å™¨èƒŒæ™¯é¢œè‰² */
            border: 1px solid rgba(255, 255, 255, 0.2); /* ç¼–è¾‘å™¨è¾¹æ¡†é¢œè‰² */
            border-radius: 12px;
            padding: 1.5rem;
            min-height: 500px;
            margin-bottom: 2rem;
        }

        .editor {
            width: 100%;
            min-height: 500px;
            background: transparent;
            border: none;
            color: var(--primary-color); /* ç¼–è¾‘å™¨æ–‡å­—é¢œè‰² */
            font-size: 1rem;
            line-height: 1.6;
            font-family: 'Inter', sans-serif;
            resize: vertical;
        }

        .editor:focus {
            outline: none;
        }

        /* é¢„è§ˆåŒºåŸŸå›¾ç‰‡æ ·å¼ */
        .preview img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 1rem 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); /* å›¾ç‰‡é˜´å½±é¢œè‰² */
        }

        /* æ‹–æ‹½åŒºåŸŸæ ·å¼ */
        .editor.dragover {
            background: rgba(250, 167, 85, 0.1); /* æ‹–æ‹½æ—¶èƒŒæ™¯é¢œè‰² */
            border-color: var(--accent-color); /* æ‹–æ‹½æ—¶è¾¹æ¡†é¢œè‰² */
            transition: all 0.3s ease;
        }

        /* ==================== é¢„è§ˆåŒºåŸŸ ==================== */
        .preview {
            color: var(--primary-color); /* é¢„è§ˆåŒºåŸŸæ–‡å­—é¢œè‰² */
            line-height: 1.6;
        }

        /* æ ‡é¢˜æ ·å¼ */
        .preview h1, .preview h2, .preview h3 {
            color: var(--primary-color); /* æ ‡é¢˜é¢œè‰² */
            margin-top: 1.5rem;
            margin-bottom: 1rem;
        }

        .preview h1 {
            font-size: 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1); /* H1ä¸‹åˆ’çº¿é¢œè‰² */
            padding-bottom: 0.5rem;
        }

        .preview h2 {
            font-size: 1.5rem;
        }

        .preview h3 {
            font-size: 1.2rem;
        }

        .preview p {
            margin-bottom: 1rem;
        }

        .preview ul, .preview ol {
            margin-bottom: 1rem;
            padding-left: 2rem;
        }

        /* ä»£ç å—æ ·å¼ */
        .preview code {
            background: rgba(0, 0, 0, 0.3); /* å†…è”ä»£ç èƒŒæ™¯é¢œè‰² */
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9rem;
        }

        .preview pre {
            background: rgba(0, 0, 0, 0.3); /* ä»£ç å—èƒŒæ™¯é¢œè‰² */
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            margin-bottom: 1rem;
        }

        .preview pre code {
            background: transparent;
            padding: 0;
        }

        /* å¼•ç”¨æ ·å¼ */
        .preview blockquote {
            border-left: 3px solid var(--accent-color); /* å¼•ç”¨è¾¹æ¡†é¢œè‰² */
            padding-left: 1rem;
            margin-left: 0;
            margin-bottom: 1rem;
            opacity: 0.8;
        }

        /* è¡¨æ ¼æ ·å¼ */
        .preview table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-bottom: 1rem;
            border-radius: 8px;
            overflow: hidden;
        }

        .preview th, .preview td {
            border: 1px solid rgba(255, 255, 255, 0.1); /* è¡¨æ ¼è¾¹æ¡†é¢œè‰² */
            padding: 0.5rem;
            text-align: left;
        }

        .preview th {
            background: rgba(0, 0, 0, 0.3); /* è¡¨æ ¼è¡¨å¤´èƒŒæ™¯é¢œè‰² */
        }

        /* è¡¨æ ¼åœ†è§’ä¼˜åŒ– */
        .preview th:first-child {
            border-top-left-radius: 8px;
        }

        .preview th:last-child {
            border-top-right-radius: 8px;
        }

        .preview tr:last-child td:first-child {
            border-bottom-left-radius: 8px;
        }

        .preview tr:last-child td:last-child {
            border-bottom-right-radius: 8px;
        }

        /* é“¾æ¥æ ·å¼ */
        .preview a {
            color: #6495ed; /* æ·¡è“è‰²é“¾æ¥é¢œè‰² */
            text-decoration: none;
            border-bottom: 1px solid transparent;
            transition: all 0.3s ease;
        }

        .preview a:hover {
            color: #4169e1; /* é“¾æ¥hoveræ—¶é¢œè‰²åŠ æ·± */
            border-bottom-color: #6495ed; /* é“¾æ¥hoveræ—¶æ˜¾ç¤ºä¸‹åˆ’çº¿ */
        }

        /* åº•éƒ¨æŒ‰é’®åŒºåŸŸ */
        .editor-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .btn-save {
            background: linear-gradient(135deg, var(--accent-color), #ff9a3c);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(250, 167, 85, 0.3);
        }

        .btn-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(250, 167, 85, 0.4);
        }

        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 1.5rem;
        }

        .modal-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            color: var(--primary-color);
            font-size: 1rem;
            margin-bottom: 1.5rem;
            box-sizing: border-box;
        }

        /* ==================== æµ…è‰²æ¨¡å¼æ ·å¼ ==================== */

        /* æµ…è‰²æ¨¡å¼ä¸‹çš„å„ç§åœ†è§’çŸ©å½¢æ¡†æ ·å¼ */
        @media (prefers-color-scheme: light) {
            .modal-input {
                background: #e0e0e0; /* æ¨¡æ€æ¡†è¾“å…¥æ¡†èƒŒæ™¯é¢œè‰² */
                border: 1px solid #d0d0d0; /* æ¨¡æ€æ¡†è¾“å…¥æ¡†è¾¹æ¡†é¢œè‰² */
                color: #000000; /* æ¨¡æ€æ¡†è¾“å…¥æ¡†æ–‡å­—é¢œè‰² */
            }

            .doc-item {
                background: #F2F2F2; /* æ–‡æ¡£å¡ç‰‡èƒŒæ™¯é¢œè‰² */
                border: 1px solid #d0d0d0; /* æ–‡æ¡£å¡ç‰‡è¾¹æ¡†é¢œè‰² */
            }

            .editor-area {
                background: #F2F2F2; /* ç¼–è¾‘å™¨èƒŒæ™¯é¢œè‰² */
                border: 1px solid #d0d0d0; /* ç¼–è¾‘å™¨è¾¹æ¡†é¢œè‰² */
            }

            .toc-container {
                background: #F2F2F2 !important; /* ä¸ç¼–è¾‘æ¡†èƒŒæ™¯ç›¸åŒ */
                border: 1px solid #d0d0d0 !important; /* ä¸ç¼–è¾‘æ¡†è¾¹æ¡†ç›¸åŒ */
            }

            .modal-content {
                background: #f0f0f0 !important; /* æ¨¡æ€æ¡†å†…å®¹èƒŒæ™¯é¢œè‰² */
            }
        }

        .light-theme .modal-input {
            background: #F2F2F2 !important; /* æ¨¡æ€æ¡†è¾“å…¥æ¡†èƒŒæ™¯é¢œè‰² */
            border: 1px solid #d0d0d0 !important; /* æ¨¡æ€æ¡†è¾“å…¥æ¡†è¾¹æ¡†é¢œè‰² */
            color: #000000 !important; /* æ¨¡æ€æ¡†è¾“å…¥æ¡†æ–‡å­—é¢œè‰² */
        }

        .light-theme .doc-item {
            background: #F2F2F2 !important; /* æ–‡æ¡£å¡ç‰‡èƒŒæ™¯é¢œè‰² */
            border: 1px solid #d0d0d0 !important; /* æ–‡æ¡£å¡ç‰‡è¾¹æ¡†é¢œè‰² */
        }

        .light-theme .editor-area {
            background: #F2F2F2 !important; /* ç¼–è¾‘å™¨èƒŒæ™¯é¢œè‰² */
            border: 1px solid #d0d0d0 !important; /* ç¼–è¾‘å™¨è¾¹æ¡†é¢œè‰² */
        }

        .light-theme .toc-container {
            background: #F2F2F2 !important; /* ä¸ç¼–è¾‘æ¡†èƒŒæ™¯ç›¸åŒ */
            border: 1px solid #d0d0d0 !important; /* ä¸ç¼–è¾‘æ¡†è¾¹æ¡†ç›¸åŒ */
        }

        .light-theme .modal-content {
            background: #f0f0f0 !important; /* æ¨¡æ€æ¡†å†…å®¹èƒŒæ™¯é¢œè‰² */
        }

        .light-theme .preview th {
            background: #e8e8e8; /* è¡¨æ ¼è¡¨å¤´èƒŒæ™¯é¢œè‰² */
        }

        /* ==================== æ·±è‰²æ¨¡å¼æ ·å¼ ==================== */

        /* æ·±è‰²æ¨¡å¼ä¸‹çš„å„ç§åœ†è§’çŸ©å½¢æ¡†æ ·å¼ */
        .dark-theme .modal-input {
            background: rgba(255, 255, 255, 0.1) !important; /* æ¨¡æ€æ¡†è¾“å…¥æ¡†èƒŒæ™¯é¢œè‰² */
            border: 1px solid rgba(255, 255, 255, 0.2) !important; /* æ¨¡æ€æ¡†è¾“å…¥æ¡†è¾¹æ¡†é¢œè‰² */
            color: var(--primary-color) !important; /* æ¨¡æ€æ¡†è¾“å…¥æ¡†æ–‡å­—é¢œè‰² */
        }

        .dark-theme .doc-item {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05)) !important; /* æ–‡æ¡£å¡ç‰‡èƒŒæ™¯é¢œè‰² */
            border: 1px solid rgba(255, 255, 255, 0.1) !important; /* æ–‡æ¡£å¡ç‰‡è¾¹æ¡†é¢œè‰² */
        }

        .dark-theme .editor-area {
            background: rgba(255, 255, 255, 0.1) !important; /* ç¼–è¾‘å™¨èƒŒæ™¯é¢œè‰² */
            border: 1px solid rgba(255, 255, 255, 0.2) !important; /* ç¼–è¾‘å™¨è¾¹æ¡†é¢œè‰² */
        }

        .dark-theme .toc-container {
            background: rgba(255, 255, 255, 0.1) !important; /* ä¸ç¼–è¾‘æ¡†èƒŒæ™¯ç›¸åŒ */
            border: 1px solid rgba(255, 255, 255, 0.2) !important; /* ä¸ç¼–è¾‘æ¡†è¾¹æ¡†ç›¸åŒ */
        }

        .dark-theme .modal-content {
            background: var(--bg-card) !important; /* æ¨¡æ€æ¡†å†…å®¹èƒŒæ™¯é¢œè‰² */
        }

        /* ==================== æµ…è‰²æ¨¡å¼ä¸‹çš„é¢„è§ˆåŒºåŸŸæ ·å¼ ==================== */

        /* æµ…è‰²æ¨¡å¼ä¸‹çš„ä»£ç å—å’Œæ–‡å­—é«˜äº®æ ·å¼ */
        @media (prefers-color-scheme: light) {
            .preview code {
                background: #e8e8e8; /* å†…è”ä»£ç èƒŒæ™¯é¢œè‰² - ç¨æ·±çš„æµ…ç°è‰² */
                border: 1px solid #d0d0d0; /* å†…è”ä»£ç è¾¹æ¡†é¢œè‰² - æµ…ç°è‰² */
                color: #000000; /* å†…è”ä»£ç æ–‡å­—é¢œè‰² */
            }

            .preview pre {
                background: #e8e8e8; /* ä»£ç å—èƒŒæ™¯é¢œè‰² - ç¨æ·±çš„æµ…ç°è‰² */
                border: 1px solid #d0d0d0; /* ä»£ç å—è¾¹æ¡†é¢œè‰² - æµ…ç°è‰² */
                color: #000000; /* ä»£ç å—æ–‡å­—é¢œè‰² */
            }

            .preview pre code {
                background: transparent;
                border: none;
            }

            .preview blockquote {
                border-left: 3px solid var(--accent-color); /* å¼•ç”¨è¾¹æ¡†é¢œè‰² - å¼ºè°ƒè‰²ï¼ˆæ©™è‰²ï¼‰ */
            }

            .preview table {
                border-collapse: separate;
                border-spacing: 0;
                border-radius: 8px;
                overflow: hidden;
            }

            .preview th, .preview td {
                border: 1px solid #d0d0d0; /* è¡¨æ ¼è¾¹æ¡†é¢œè‰² - æµ…ç°è‰² */
            }

            /* è¡¨æ ¼åœ†è§’ä¼˜åŒ– */
            .preview th:first-child {
                border-top-left-radius: 8px;
            }

            .preview th:last-child {
                border-top-right-radius: 8px;
            }

            .preview tr:last-child td:first-child {
                border-bottom-left-radius: 8px;
            }

            .preview tr:last-child td:last-child {
                border-bottom-right-radius: 8px;
            }

            .preview h1 {
                border-bottom: 1px solid #d0d0d0; /* H1ä¸‹åˆ’çº¿é¢œè‰² - æµ…ç°è‰² */
            }

            .preview hr {
                border: none;
                border-top: 1px solid var(--border-color); /* åˆ†éš”çº¿é¢œè‰² - ä¸èƒŒæ™¯è¾¹æ¡†ç›¸åŒ */
                margin: 2rem 0;
            }
        }

        .light-theme .preview code {
            background: #e8e8e8 !important; /* å†…è”ä»£ç èƒŒæ™¯é¢œè‰² - ç¨æ·±çš„æµ…ç°è‰² */
            border: 1px solid #d0d0d0 !important; /* å†…è”ä»£ç è¾¹æ¡†é¢œè‰² - æµ…ç°è‰² */
            color: #000000 !important; /* å†…è”ä»£ç æ–‡å­—é¢œè‰² */
        }

        .light-theme .preview pre {
            background: #e8e8e8 !important; /* ä»£ç å—èƒŒæ™¯é¢œè‰² - ç¨æ·±çš„æµ…ç°è‰² */
            border: 1px solid #d0d0d0 !important; /* ä»£ç å—è¾¹æ¡†é¢œè‰² - æµ…ç°è‰² */
            color: #000000 !important; /* ä»£ç å—æ–‡å­—é¢œè‰² */
        }

        .light-theme .preview pre code {
            background: transparent !important;
            border: none !important;
        }

        .light-theme .preview blockquote {
            border-left: 3px solid var(--accent-color) !important; /* å¼•ç”¨è¾¹æ¡†é¢œè‰² - å¼ºè°ƒè‰²ï¼ˆæ©™è‰²ï¼‰ */
        }

        .light-theme .preview table {
            border-collapse: separate !important;
            border-spacing: 0 !important;
            border-radius: 8px !important;
            overflow: hidden !important;
        }

        .light-theme .preview th, .light-theme .preview td {
            border: 1px solid #d0d0d0 !important; /* è¡¨æ ¼è¾¹æ¡†é¢œè‰² - æµ…ç°è‰² */
        }

        /* è¡¨æ ¼åœ†è§’ä¼˜åŒ– */
        .light-theme .preview th:first-child {
            border-top-left-radius: 8px !important;
        }

        .light-theme .preview th:last-child {
            border-top-right-radius: 8px !important;
        }

        .light-theme .preview tr:last-child td:first-child {
            border-bottom-left-radius: 8px !important;
        }

        .light-theme .preview tr:last-child td:last-child {
            border-bottom-right-radius: 8px !important;
        }

        .light-theme .preview h1 {
            border-bottom: 1px solid #d0d0d0 !important; /* H1ä¸‹åˆ’çº¿é¢œè‰² - æµ…ç°è‰² */
        }

        .light-theme .preview hr {
            border: none !important;
            border-top: 1px solid var(--border-color) !important; /* åˆ†éš”çº¿é¢œè‰² - ä¸èƒŒæ™¯è¾¹æ¡†ç›¸åŒ */
            margin: 2rem 0 !important;
        }

        /* æµ…è‰²æ¨¡å¼ä¸‹çš„é“¾æ¥æ ·å¼ */
        @media (prefers-color-scheme: light) {
            .preview a {
                color: #6495ed !important; /* æ·¡è“è‰²é“¾æ¥é¢œè‰² */
                text-decoration: none;
                border-bottom: 1px solid transparent;
                transition: all 0.3s ease;
            }

            .preview a:hover {
                color: #4169e1 !important; /* é“¾æ¥hoveræ—¶é¢œè‰²åŠ æ·± */
                border-bottom-color: #6495ed !important; /* é“¾æ¥hoveræ—¶æ˜¾ç¤ºä¸‹åˆ’çº¿ */
            }
        }

        .light-theme .preview a {
            color: #6495ed !important; /* æ·¡è“è‰²é“¾æ¥é¢œè‰² */
            text-decoration: none;
            border-bottom: 1px solid transparent;
            transition: all 0.3s ease;
        }

        .light-theme .preview a:hover {
            color: #4169e1 !important; /* é“¾æ¥hoveræ—¶é¢œè‰²åŠ æ·± */
            border-bottom-color: #6495ed !important; /* é“¾æ¥hoveræ—¶æ˜¾ç¤ºä¸‹åˆ’çº¿ */
        }

        /* æ·±è‰²æ¨¡å¼ä¸‹çš„é“¾æ¥æ ·å¼ */
        .dark-theme .preview a {
            color: #6495ed !important; /* æ·¡è“è‰²é“¾æ¥é¢œè‰² */
            text-decoration: none;
            border-bottom: 1px solid transparent;
            transition: all 0.3s ease;
        }

        .dark-theme .preview a:hover {
            color: #4169e1 !important; /* é“¾æ¥hoveræ—¶é¢œè‰²åŠ æ·± */
            border-bottom-color: #6495ed !important; /* é“¾æ¥hoveræ—¶æ˜¾ç¤ºä¸‹åˆ’çº¿ */
        }

        .modal-input::placeholder {
            color: var(--secondary-color);
            opacity: 0.5;
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        .btn-cancel {
            background: rgba(255, 255, 255, 0.1);
            color: var(--primary-color);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-confirm {
            background: linear-gradient(135deg, var(--accent-color), #ff9a3c);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        /* åŠ è½½çŠ¶æ€ */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            color: var(--secondary-color);
            font-size: 1.2rem;
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--secondary-color);
            opacity: 0.7;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .doc-title {
                font-size: 2rem;
            }

            .doc-list {
                grid-template-columns: 1fr;
            }

            .doc-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            /* ç¼©å°é¡µé¢å®¹å™¨å·¦å³è¾¹è· */
            .doc-container {
                padding: 0 1rem;
            }

            /* ç¼©å°ç¼–è¾‘å™¨æ ‡é¢˜åº•éƒ¨è¾¹è· */
            .editor-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
                margin-bottom: 1.5rem; /* è°ƒæ•´ä¸ºä¸æ ‡é¢˜å’Œå¯¼èˆªæ ä¹‹é—´é—´éš”ç›¸ç­‰çš„å€¼ */
            }

            .editor-title-input {
                width: 100%;
                margin-right: 0;
            }

            .editor-controls {
                width: 100%;
                justify-content: space-between;
            }

            .modal-content {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">Weatheraintbad.Wiki</div>
            <ul class="nav-menu">
                <li><a href="dashboard.html">æ•°æ®çœ‹æ¿</a></li>
                <li><a href="doc.html">æ–‡æ¡£ç®¡ç†</a></li>
                <li><a href="wiki.html">Wikiç®¡ç†</a></li>
            </ul>
            <div class="nav-buttons">
                <!-- æ¨¡å¼åˆ‡æ¢æŒ‰é’®ï¼ˆåªåœ¨ç¼–è¾‘å™¨é¡µé¢æ˜¾ç¤ºï¼‰ -->
                <div id="mode-buttons" style="display: none; gap: 0.5rem; display: none; align-items: center;">
                    <button class="mode-btn edit-btn active" onclick="switchMode('edit')" aria-label="ç¼–è¾‘æ¨¡å¼">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                    </button>
                    <button class="mode-btn preview-btn" onclick="switchMode('preview')" aria-label="é¢„è§ˆæ¨¡å¼">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                    </button>
                </div>
                <button id="theme-toggle" class="theme-toggle" aria-label="åˆ‡æ¢ä¸»é¢˜">
                    <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                    <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </button>
            </div>
        </div>
    </nav>

    <!-- ä¾§è¾¹å¯¼èˆªæ  -->
    <div class="toc-container" id="toc-container">
        <div class="toc-title">ç›®å½•</div>
        <ul class="toc-list" id="toc-list">
            <!-- ç›®å½•å°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆ -->
        </ul>
    </div>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <section class="doc-manager">
        <div class="doc-content">
            <div class="doc-container">
                <!-- æ–‡æ¡£åˆ—è¡¨é¡µé¢ -->
                <div id="list-view">
                    <div class="doc-header">
                        <h1 class="doc-title">Wikiç®¡ç†</h1>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn-new" onclick="showCreateModal()">æ–°å»ºWiki</button>
                            <button class="btn-new" onclick="showCorrectionList()">æŸ¥çœ‹ä¿®æ­£</button>
                        </div>
                    </div>
                    <div id="doc-list" class="doc-list">
                        <!-- æ–‡æ¡£åˆ—è¡¨å°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <div id="empty-state" class="empty-state" style="display: none;">
                        <div class="empty-state-icon">ğŸ“„</div>
                        <div>æš‚æ— æ–‡æ¡£ï¼Œç‚¹å‡»"æ–°å»ºæ–‡æ¡£"å¼€å§‹åˆ›å»º</div>
                    </div>
                </div>

                <!-- ç¼–è¾‘å™¨é¡µé¢ -->
                <div id="editor-view" style="display: none;">
                    <div class="editor-container">
                        <!-- æ ‡é¢˜åŒºåŸŸ -->
                        <div class="editor-header">
                            <div class="editor-title-container">
                                <input type="text" id="editor-title" class="editor-title-input" placeholder="è¯·è¾“å…¥æ–‡æ¡£æ ‡é¢˜">
                            </div>
                            <div class="editor-controls">
                                <button class="btn-back" onclick="goBackToList()">â† è¿”å›</button>
                            </div>
                        </div>

                        <div class="editor-area">
                            <textarea id="editor" class="editor" placeholder="è¯·è¾“å…¥ Markdown å†…å®¹... å¯ä»¥ç›´æ¥æ‹–å…¥å›¾ç‰‡"></textarea>
                            <div id="preview" class="preview" style="display: none;"></div>
                        </div>

                        <div class="editor-footer">
                            <button class="btn-delete" onclick="deleteDocument()">åˆ é™¤</button>
                            <button class="btn-share" onclick="toggleShareMode()">åˆ†äº«</button>
                            <button class="btn-publish" id="publish-btn" onclick="togglePublish()">å‘å¸ƒäºåšå®¢</button>
                            <button class="btn-save" onclick="saveDocument()">ä¿å­˜æ–‡æ¡£</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- æ–°å»ºæ–‡æ¡£æ¨¡æ€æ¡† -->
    <div id="create-modal" class="modal">
        <div class="modal-content">
            <div class="modal-title">æ–°å»ºæ–‡æ¡£</div>
            <input type="text" id="new-doc-title" class="modal-input" placeholder="è¯·è¾“å…¥æ–‡æ¡£æ ‡é¢˜">
            <div class="modal-buttons">
                <button class="btn-cancel" onclick="hideCreateModal()">å–æ¶ˆ</button>
                <button class="btn-confirm" onclick="createDocument()">åˆ›å»º</button>
            </div>
        </div>
    </div>

    <!-- åŠ è½½åŠ¨ç”» -->
    <div class="loader-overlay" id="loader">
        <div class="loader-decoration">
            <div class="floating-element el-1"></div>
            <div class="floating-element el-2"></div>
            <div class="floating-element el-3"></div>
        </div>
    </div>

    <script src="script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        // æ–‡æ¡£æ•°æ®å­˜å‚¨
        let documents = [];
        let currentDocId = null;
        // Supabase é…ç½®
        const SUPABASE_URL = 'https://wyoofofxviolwdebkpkt.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_TOTiug5k7UCGYLeLib0cUw_Vqm06ZyC';

        // åˆå§‹åŒ– Supabase å®¢æˆ·ç«¯
        const supabase = {
            url: SUPABASE_URL,
            anonKey: SUPABASE_ANON_KEY,
            from: function(table) {
                return {
                    select: async function(query = '*') {
                        const url = `${SUPABASE_URL}/rest/v1/${table}?${new URLSearchParams({
                            select: query,
                            apikey: SUPABASE_ANON_KEY
                        })}`;
                        const response = await fetch(url, {
                            headers: {
                                'apikey': SUPABASE_ANON_KEY,
                                'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                                'Content-Type': 'application/json',
                                'Accept': 'application/json'
                            }
                        });
                        if (!response.ok) throw new Error(`Select failed: ${response.status}`);
                        return { data: await response.json(), error: null };
                    },
                    insert: async function(data) {
                        const url = `${SUPABASE_URL}/rest/v1/${table}?${new URLSearchParams({
                            apikey: SUPABASE_ANON_KEY
                        })}`;
                        const response = await fetch(url, {
                            method: 'POST',
                            headers: {
                                'apikey': SUPABASE_ANON_KEY,
                                'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                                'Content-Type': 'application/json',
                                'Accept': 'application/json',
                                'Prefer': 'return=representation'
                            },
                            body: JSON.stringify(data)
                        });
                        if (!response.ok) throw new Error(`Insert failed: ${response.status}`);
                        return { data: await response.json(), error: null };
                    },
                    update: async function(data, id) {
                        const url = `${SUPABASE_URL}/rest/v1/${table}?id=eq.${id}&${new URLSearchParams({
                            apikey: SUPABASE_ANON_KEY
                        })}`;
                        console.log('Update request:', {
                            url: url,
                            data: data
                        });
                        const response = await fetch(url, {
                            method: 'PATCH',
                            headers: {
                                'apikey': SUPABASE_ANON_KEY,
                                'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                                'Content-Type': 'application/json',
                                'Accept': 'application/json',
                                'Prefer': 'return=representation'
                            },
                            body: JSON.stringify(data)
                        });
                        if (!response.ok) {
                            const errorText = await response.text();
                            console.error('Update failed response:', response.status, errorText);
                            throw new Error(`Update failed: ${response.status} - ${errorText}`);
                        }
                        const result = await response.json();
                        console.log('Update success:', result);
                        return { data: result, error: null };
                    },
                    delete: async function(id = null) {
                        let url;
                        if (id) {
                            url = `${SUPABASE_URL}/rest/v1/${table}?id=eq.${id}`;
                        } else {
                            // åˆ é™¤æ‰€æœ‰æ–‡æ¡£éœ€è¦ä½¿ç”¨ç‰¹æ®Šçš„æŸ¥è¯¢å‚æ•°
                            url = `${SUPABASE_URL}/rest/v1/${table}?id=neq.0`;
                        }
                        const response = await fetch(url, {
                            method: 'DELETE',
                            headers: {
                                'apikey': SUPABASE_ANON_KEY,
                                'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                                'Content-Type': 'application/json',
                                'Accept': 'application/json'
                            }
                        });
                        if (!response.ok) throw new Error(`Delete failed: ${response.status}`);
                        return { data: null, error: null };
                    }
                };
            }
        };

        // ç”Ÿæˆå”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆ8ä½éšæœºæ•°å­—å’Œå­—æ¯ç»„åˆï¼‰
        function generateSlug() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let slug = '';
            for (let i = 0; i < 8; i++) {
                slug += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return slug;
        }

        // ä» Supabase åŠ è½½æ–‡æ¡£
        async function loadDocuments() {
            if (!supabase) {
                console.warn('æœªé…ç½® Supabase');
                documents = [];
                return;
            }

            try {
                // ç›´æ¥æ„é€ æŸ¥è¯¢ URLï¼Œå°è¯•æŒ‰ç±»å‹ç­›é€‰åŠ è½½æ–‡æ¡£
                const url = `${SUPABASE_URL}/rest/v1/documents?select=*&type=eq.wiki&${new URLSearchParams({
                    apikey: SUPABASE_ANON_KEY
                })}`;

                const response = await fetch(url, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    }
                });

                // å¦‚æœæŒ‰ç±»å‹ç­›é€‰å¤±è´¥ï¼ˆå¯èƒ½æ˜¯ type å­—æ®µä¸å­˜åœ¨ï¼‰ï¼Œåˆ™åŠ è½½æ‰€æœ‰æ–‡æ¡£
                if (!response.ok) {
                    console.warn('æŒ‰ç±»å‹ç­›é€‰å¤±è´¥ï¼ŒåŠ è½½æ‰€æœ‰æ–‡æ¡£:', response.status);
                    const allResponse = await fetch(`${SUPABASE_URL}/rest/v1/documents?${new URLSearchParams({
                        select: '*',
                        apikey: SUPABASE_ANON_KEY
                    })}`, {
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        }
                    });

                    if (!allResponse.ok) {
                        throw new Error(`Failed to load documents: ${allResponse.status}`);
                    }

                    const allData = await allResponse.json();
                    // ä¸ºæ²¡æœ‰ç±»å‹å­—æ®µçš„æ–‡æ¡£è®¾ç½®é»˜è®¤ç±»å‹
                    documents = allData.map(doc => ({
                        ...doc,
                        type: doc.type || 'wiki'
                    }));
                    console.log('ä» Supabase åŠ è½½äº†æ‰€æœ‰', documents.length, 'ä¸ªæ–‡æ¡£');
                } else {
                    // ç±»å‹ç­›é€‰æˆåŠŸ
                    const data = await response.json();
                    documents = data;
                    console.log('ä» Supabase åŠ è½½äº†', documents.length, 'ä¸ª doc ç±»å‹æ–‡æ¡£');
                }
            } catch (error) {
                console.error('ä» Supabase åŠ è½½æ–‡æ¡£å¤±è´¥:', error);
                documents = [];
            }
        }
1
        // ä¿å­˜æ–‡æ¡£åˆ° Supabase
        async function saveDocuments() {
            if (!supabase) {
                console.warn('æœªé…ç½® Supabase');
                return { success: false, message: 'æœªé…ç½® Supabase' };
            }

            try {
                // è·å–å½“å‰ Supabase ä¸­çš„æ‰€æœ‰ doc ç±»å‹æ–‡æ¡£çš„ id å’Œ type
                const { data: allExistingDocs, error: allFetchError } = await supabase.from('documents').select('id, type');
                if (allFetchError) {
                    throw new Error(`Failed to fetch all existing documents: ${allFetchError.message}`);
                }

                // æ’å…¥æˆ–æ›´æ–°æ–‡æ¡£
                for (const doc of documents) {
                    const existingDoc = allExistingDocs.find(d => d.id === doc.id && d.type === 'wiki');
                    if (existingDoc) {
                        // æ›´æ–°ç°æœ‰æ–‡æ¡£ï¼ˆä¸æ›´æ–° slug å­—æ®µä»¥é¿å…å†²çªï¼‰
                        await supabase.from('documents').update({
                            title: doc.title,
                            content: doc.content,
                            updated_at: doc.updated_at,
                            published: doc.published || false,
                            type: doc.type || 'wiki'
                        }, doc.id);
                    } else {
                        // æ£€æŸ¥æ˜¯å¦å­˜åœ¨ç›¸åŒ slug çš„æ–‡æ¡£
                        const existingSlugDoc = allExistingDocs.find(d => d.slug === doc.slug);
                        if (existingSlugDoc) {
                            // å¦‚æœå­˜åœ¨ç›¸åŒ slug çš„æ–‡æ¡£ï¼Œç”Ÿæˆæ–°çš„å”¯ä¸€ slug
                            console.warn(`Slug '${doc.slug}' å·²å­˜åœ¨ï¼Œæ­£åœ¨ç”Ÿæˆæ–°çš„ slug`);
                            doc.slug = generateSlug();
                        }

                        // æ£€æŸ¥ id æ˜¯å¦å·²ç»å­˜åœ¨äºå…¶ä»–ç±»å‹çš„æ–‡æ¡£ä¸­
                        const idExists = allExistingDocs.find(d => d.id === doc.id);
                        if (idExists) {
                            // å¦‚æœ id å·²ç»å­˜åœ¨ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„ id
                            const generateUniqueId = () => {
                                const timestamp = Date.now().toString(36);
                                const randomStr = Math.random().toString(36).substring(2, 10);
                                return timestamp + randomStr;
                            };
                            doc.id = generateUniqueId();
                        }

                        // æ’å…¥æ–°æ–‡æ¡£
                        await supabase.from('documents').insert(doc);
                    }
                }

                console.log('æ–‡æ¡£å·²ä¿å­˜åˆ° Supabase');
                return { success: true, message: 'æ–‡æ¡£å·²ä¿å­˜è‡³æœåŠ¡å™¨' };
            } catch (error) {
                console.error('ä¿å­˜æ–‡æ¡£åˆ° Supabase å¤±è´¥:', error);
                return { success: false, message: `æ–‡æ¡£ä¿å­˜å¤±è´¥: ${error.message}` };
            }
        }

        // è§£æ URL è·¯ç”±ï¼ˆæ”¯æŒç®€æ´çš„å“ˆå¸Œè·¯ç”±æ ¼å¼ï¼‰
        function parseUrl() {
            // é¦–å…ˆæ£€æŸ¥ç®€æ´æ ¼å¼çš„å“ˆå¸Œè·¯ç”±ï¼ˆæ–°æ ¼å¼ï¼‰
            const hashPath = window.location.hash.slice(1);
            const simpleHashMatch = hashPath.match(/^([\w-]+)$/);
            if (simpleHashMatch) {
                return { type: 'doc', slug: simpleHashMatch[1] };
            }

            // å…¼å®¹æ—§æ ¼å¼çš„å“ˆå¸Œè·¯ç”±ï¼ˆ/doc/abc123ï¼‰
            const oldHashMatch = hashPath.match(/^\/doc\/([\w-]+)$/);
            if (oldHashMatch) {
                return { type: 'doc', slug: oldHashMatch[1] };
            }

            // æ£€æŸ¥è·¯å¾„è·¯ç”±ï¼ˆ/doc/abc123ï¼‰
            const path = window.location.pathname;
            const pathMatch = path.match(/\/doc\/([\w-]+)$/);
            if (pathMatch) {
                return { type: 'doc', slug: pathMatch[1] };
            }

            return { type: 'list' };
        }

        // ç”Ÿæˆåˆ†äº«é“¾æ¥ï¼ˆä½¿ç”¨ç®€æ´çš„å“ˆå¸Œè·¯ç”±æ ¼å¼ï¼‰
        function generateShareUrl(docId) {
            const doc = documents.find(d => d.id === docId);
            if (!doc) return null;

            // å¦‚æœæ–‡æ¡£æ²¡æœ‰ slugï¼Œç”Ÿæˆä¸€ä¸ª
            if (!doc.slug) {
                doc.slug = generateSlug();
                saveDocuments();
            }

            return window.location.origin + '/wiki.html#' + doc.slug;
        }

        // ç›‘å¬è·¯ç”±å˜åŒ–ï¼ˆæ”¯æŒå“ˆå¸Œè·¯ç”±å’Œè·¯å¾„è·¯ç”±ï¼‰
        function handleRouteChange() {
            const route = parseUrl();
            if (route.type === 'doc') {
                const doc = documents.find(d => d.slug === route.slug);
                if (doc) {
                    isShareMode = true;
                    currentDocId = doc.id;
                    const titleInput = document.getElementById('editor-title');
                    titleInput.value = doc.title;
                    titleInput.readOnly = true; // åˆ†äº«æ¨¡å¼ä¸‹æ ‡é¢˜ä¸å¯ä¿®æ”¹
                    titleInput.style.display = 'none'; // åˆ†äº«æ¨¡å¼ä¸‹éšè—æ ‡é¢˜è¾“å…¥æ¡†
                    const editor = document.getElementById('editor');
                    editor.value = doc.content;
                    editor.readOnly = true; // åˆ†äº«æ¨¡å¼ä¸‹å†…å®¹ä¸å¯ä¿®æ”¹
                    updatePreview();

                    document.getElementById('list-view').style.display = 'none';
                    document.getElementById('editor-view').style.display = 'block';
                    document.getElementById('mode-buttons').style.display = 'flex';
                    switchMode('preview');
                    hideEditorControls();
                    hideFooterControls();
                    hideNavMenu();

                    // åˆ†äº«æ¨¡å¼ä¸‹éšè—ç¼–è¾‘å’Œé¢„è§ˆæŒ‰é’®
                    const editBtn = document.querySelector('.edit-btn');
                    const previewBtn = document.querySelector('.preview-btn');
                    if (editBtn) editBtn.style.display = 'none';
                    if (previewBtn) previewBtn.style.display = 'none';
                } else {
                    alert('æ–‡æ¡£ä¸å­˜åœ¨');
                }
            } else {
                // æ˜¾ç¤ºæ–‡æ¡£åˆ—è¡¨
                goBackToList();
            }
        }

        // ç›‘å¬ hash å˜åŒ–ï¼ˆå…¼å®¹æ—§æ ¼å¼ï¼‰
        window.addEventListener('hashchange', handleRouteChange);

        // ç›‘å¬ popstate äº‹ä»¶ï¼ˆå¤„ç†æµè§ˆå™¨å‰è¿›/åé€€æŒ‰é’®ï¼‰
        window.addEventListener('popstate', handleRouteChange);

        // åè°ƒè¯•ä»£ç 
        (function() {
            // ç¦æ­¢å³é”®èœå•
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
            });

            // ç¦æ­¢é€‰æ‹©æ–‡æœ¬ï¼ˆä½†å…è®¸åˆ†äº«é“¾æ¥è¾“å…¥æ¡†å’Œç¼–è¾‘å™¨é€‰æ‹©ï¼‰
            document.addEventListener('selectstart', function(e) {
                if (e.target && (e.target.id === 'share-url' || e.target.id === 'editor' || e.target.id === 'editor-title')) {
                    return; // å…è®¸åˆ†äº«é“¾æ¥è¾“å…¥æ¡†ã€ç¼–è¾‘å™¨å’Œæ ‡é¢˜è¾“å…¥æ¡†é€‰æ‹©
                }
                e.preventDefault();
            });

            // ç¦æ­¢å¤åˆ¶ï¼ˆä½†å…è®¸åˆ†äº«é“¾æ¥ã€ç¼–è¾‘å™¨å’Œæ ‡é¢˜è¾“å…¥æ¡†å¤åˆ¶ï¼‰
            document.addEventListener('copy', function(e) {
                if (e.target && (e.target.id === 'share-url' || e.target.id === 'editor' || e.target.id === 'editor-title')) {
                    return; // å…è®¸åˆ†äº«é“¾æ¥ã€ç¼–è¾‘å™¨å’Œæ ‡é¢˜è¾“å…¥æ¡†å¤åˆ¶
                }
                e.preventDefault();
            });

            // ç¦æ­¢å‰ªåˆ‡ï¼ˆä½†å…è®¸ç¼–è¾‘å™¨å’Œæ ‡é¢˜è¾“å…¥æ¡†å‰ªåˆ‡ï¼‰
            document.addEventListener('cut', function(e) {
                if (e.target && (e.target.id === 'editor' || e.target.id === 'editor-title')) {
                    return; // å…è®¸ç¼–è¾‘å™¨å’Œæ ‡é¢˜è¾“å…¥æ¡†å‰ªåˆ‡
                }
                e.preventDefault();
            });

            // ç¦æ­¢ç²˜è´´ï¼ˆä½†å…è®¸ç¼–è¾‘å™¨å’Œæ ‡é¢˜è¾“å…¥æ¡†ç²˜è´´ï¼‰
            document.addEventListener('paste', function(e) {
                if (e.target && (e.target.id === 'editor' || e.target.id === 'editor-title')) {
                    return; // å…è®¸ç¼–è¾‘å™¨å’Œæ ‡é¢˜è¾“å…¥æ¡†ç²˜è´´
                }
                e.preventDefault();
            });

            // æ£€æµ‹è°ƒè¯•å™¨
            function detectDebugger() {
                const start = performance.now();
                debugger;
                const end = performance.now();
                return end - start > 100; // è°ƒè¯•å™¨æ‰“å¼€æ—¶ï¼Œæ—¶é—´å·®ä¼šå¾ˆå¤§
            }

            // æ£€æµ‹æ§åˆ¶å°æ˜¯å¦æ‰“å¼€
            function detectConsole() {
                const start = performance.now();
                console.log('');
                return performance.now() - start > 10;
            }

            // å®šæ—¶æ£€æµ‹
            setInterval(function() {
                if (detectDebugger() || detectConsole()) {
                    document.body.innerHTML = `
                        <div style="display: flex; justify-content: center; align-items: center; height: 100vh; color: var(--secondary-color); font-size: 1.5rem;">
                            æ£€æµ‹åˆ°è°ƒè¯•è¡Œä¸ºï¼Œé¡µé¢å·²é”å®š
                        </div>
                    `;
                }
            }, 1000);
        })();

        // é¡µé¢è®¿é—®å¯†ç 
        const ACCESS_PASSWORD = atob('MTQ3ODk2MzI1');
        let isPageAccessible = false;

        // æ˜¾ç¤ºè®¿é—®å¯†ç å¼¹çª—
        function showAccessPasswordModal() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-title">è®¿é—®å¯†ç </div>
                    <input type="password" id="access-password-input" class="modal-input" placeholder="è¯·è¾“å…¥è®¿é—®å¯†ç ">
                    <div class="modal-buttons">
                        <button class="btn-confirm" onclick="verifyAccessPassword()">ç¡®è®¤</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // éªŒè¯è®¿é—®å¯†ç 
        async function verifyAccessPassword() {
            const password = document.getElementById('access-password-input').value;
            if (password === ACCESS_PASSWORD) {
                isPageAccessible = true;
                const modal = document.querySelector('.modal.active');
                if (modal) {
                    modal.remove();
                }
                await initPage(); // éªŒè¯é€šè¿‡åå¼‚æ­¥åˆå§‹åŒ–é¡µé¢
            } else {
                alert('å¯†ç é”™è¯¯');
            }
        }

        // åˆå§‹åŒ–é¡µé¢
        async function initPage() {
            await loadDocuments(); // ä½¿ç”¨å¼‚æ­¥åŠ è½½
            renderDocList();
            // æ•°æ®åŠ è½½å®Œæˆåéšè—åŠ è½½åŠ¨ç”»
            setTimeout(() => {
                const loader = document.getElementById('loader');
                if (loader) {
                    loader.classList.add('hidden');
                }
            }, 500);

            // åŠ¨æ€è°ƒæ•´ä¾§è¾¹å¯¼èˆªæ çš„å·¦è¾¹è·ï¼Œä½¿å…¶ä½äºå¯¼èˆªæ logoçš„ä¸‹æ–¹
            adjustTocPosition();
            // ç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼Œé‡æ–°è°ƒæ•´ä¾§è¾¹å¯¼èˆªæ ä½ç½®
            window.addEventListener('resize', adjustTocPosition);
        }

        // è°ƒæ•´ä¾§è¾¹å¯¼èˆªæ ä½ç½®
        function adjustTocPosition() {
            const logo = document.querySelector('.logo');
            const tocContainer = document.getElementById('toc-container');
            if (logo && tocContainer) {
                const logoRect = logo.getBoundingClientRect();
                // ä¾§è¾¹å¯¼èˆªæ çš„å·¦è¾¹è·è®¾ç½®ä¸ºlogoçš„å·¦è¾¹è·
                tocContainer.style.left = logoRect.left + 'px';
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºå¯†ç è¾“å…¥æ¡†
        document.addEventListener('DOMContentLoaded', async function() {
            const route = parseUrl();

            // å¦‚æœæ˜¯æ–‡æ¡£é¡µé¢ç›´æ¥æ˜¾ç¤ºå†…å®¹ï¼ˆæ— éœ€å¯†ç ï¼‰
            if (route.type === 'doc') {
                await loadDocuments(); // å¼‚æ­¥åŠ è½½
                const doc = documents.find(d => d.slug === route.slug);
                if (doc) {
                    // è¿›å…¥åˆ†äº«æ¨¡å¼
                    isShareMode = true;
                    currentDocId = doc.id;
                    const titleInput = document.getElementById('editor-title');
                    titleInput.value = doc.title;
                    titleInput.readOnly = true; // åˆ†äº«æ¨¡å¼ä¸‹æ ‡é¢˜ä¸å¯ä¿®æ”¹
                    titleInput.style.display = 'none'; // åˆ†äº«æ¨¡å¼ä¸‹éšè—æ ‡é¢˜è¾“å…¥æ¡†
                    const editor = document.getElementById('editor');
                    editor.value = doc.content;
                    editor.readOnly = true; // åˆ†äº«æ¨¡å¼ä¸‹å†…å®¹ä¸å¯ä¿®æ”¹
                    updatePreview();

                    document.getElementById('list-view').style.display = 'none';
                    document.getElementById('editor-view').style.display = 'block';
                    document.getElementById('mode-buttons').style.display = 'flex'; // æ˜¾ç¤ºæ¨¡å¼åˆ‡æ¢æŒ‰é’®
                    switchMode('preview'); // åˆ‡æ¢åˆ°é¢„è§ˆæ¨¡å¼
                    hideEditorControls(); // éšè—é¡¶éƒ¨ç¼–è¾‘æ§ä»¶
                    hideFooterControls(); // éšè—åº•éƒ¨ç¼–è¾‘æ§ä»¶
                    hideNavMenu(); // éšè—å¯¼èˆªèœå•

                    // åŠ¨æ€è°ƒæ•´ä¾§è¾¹å¯¼èˆªæ çš„å·¦è¾¹è·ï¼Œä½¿å…¶ä½äºå¯¼èˆªæ logoçš„ä¸‹æ–¹
                    adjustTocPosition();
                    // ç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼Œé‡æ–°è°ƒæ•´ä¾§è¾¹å¯¼èˆªæ ä½ç½®
                    window.addEventListener('resize', adjustTocPosition);
                } else {
                    // æ–‡æ¡£ä¸å­˜åœ¨ï¼Œæ˜¾ç¤ºé”™è¯¯é¡µé¢
                    document.body.innerHTML = `
                        <div class="doc-manager" style="display: flex; align-items: center; justify-content: center;">
                            <div class="doc-container" style="text-align: center;">
                                <h1 style="color: var(--primary-color); font-size: 2rem; margin-bottom: 1rem;">æ–‡æ¡£ä¸å­˜åœ¨</h1>
                                <p style="color: var(--secondary-color); font-size: 1.2rem;">æ‚¨è®¿é—®çš„æ–‡æ¡£ä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤</p>
                                <a href="/wiki.html" style="display: inline-block; margin-top: 2rem; padding: 0.75rem 1.5rem; background: var(--accent-color); color: white; text-decoration: none; border-radius: 8px;">è¿”å›æ–‡æ¡£åˆ—è¡¨</a>
                            </div>
                        </div>
                    `;
                }
                // æ•°æ®åŠ è½½å®Œæˆåéšè—åŠ è½½åŠ¨ç”»
                setTimeout(() => {
                    const loader = document.getElementById('loader');
                    if (loader) {
                        loader.classList.add('hidden');
                    }
                }, 500);
            } else {
                // æ™®é€šè®¿é—®ï¼Œéœ€è¦å¯†ç 
                showAccessPasswordModal();
                // æ•°æ®åŠ è½½å®Œæˆåéšè—åŠ è½½åŠ¨ç”»
                setTimeout(() => {
                    const loader = document.getElementById('loader');
                    if (loader) {
                        loader.classList.add('hidden');
                    }
                }, 500);
            }
        });


        // æ¸²æŸ“æ–‡æ¡£åˆ—è¡¨
        function renderDocList() {
            const listContainer = document.getElementById('doc-list');
            const emptyState = document.getElementById('empty-state');

            // ç­›é€‰å‡ºå½“å‰é¡µé¢ç±»å‹çš„æ–‡æ¡£
            const filteredDocs = documents.filter(doc => doc.type === 'wiki');

            if (filteredDocs.length === 0) {
                listContainer.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';

            listContainer.innerHTML = filteredDocs.map(doc => `
                <div class="doc-item" onclick="openDocument('${doc.id}')">
                    <div class="doc-item-title">${escapeHtml(doc.title)}</div>
                    <div class="doc-item-meta">
                        <span>${formatDate(doc.updated_at)}</span>
                    </div>
                </div>
            `).join('');
        }

        // æ˜¾ç¤ºæ–°å»ºæ–‡æ¡£æ¨¡æ€æ¡†
        function showCreateModal() {
            document.getElementById('new-doc-title').value = '';
            document.getElementById('create-modal').classList.add('active');
        }

        // éšè—æ–°å»ºæ–‡æ¡£æ¨¡æ€æ¡†
        function hideCreateModal() {
            document.getElementById('create-modal').classList.remove('active');
        }

        // åˆ›å»ºæ–°æ–‡æ¡£
        function createDocument() {
            const title = document.getElementById('new-doc-title').value.trim();
            if (!title) {
                alert('è¯·è¾“å…¥æ–‡æ¡£æ ‡é¢˜');
                return;
            }

            // ç”Ÿæˆæ›´å¯é çš„å”¯ä¸€æ ‡è¯†ç¬¦
            const generateUniqueId = () => {
                const timestamp = Date.now().toString(36);
                const randomStr = Math.random().toString(36).substring(2, 10);
                return timestamp + randomStr;
            };

            const newDoc = {
                id: generateUniqueId(),
                title: title,
                content: '',
                slug: generateSlug(), // æ·»åŠ åˆ†äº«æ ‡è¯†ç¬¦
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString(),
                published: false, // æ·»åŠ å‘å¸ƒçŠ¶æ€å­—æ®µ
                type: 'wiki' // æ–‡æ¡£ç±»å‹ä¸º wiki
            };

            documents.unshift(newDoc);
            saveDocuments();
            hideCreateModal();
            openDocument(newDoc.id);
        }

        // æ‰“å¼€æ–‡æ¡£è¿›è¡Œç¼–è¾‘
        function openDocument(docId) {
            const doc = documents.find(d => d.id === docId);
            if (!doc) return;

            currentDocId = docId;
            const titleInput = document.getElementById('editor-title');
            const editor = document.getElementById('editor');

            titleInput.value = doc.title;
            titleInput.readOnly = false; // ç¡®ä¿æ ‡é¢˜å¯ç¼–è¾‘
            titleInput.style.display = 'block'; // ç¼–è¾‘æ¨¡å¼ä¸‹æ˜¾ç¤ºæ ‡é¢˜è¾“å…¥æ¡†
            editor.value = doc.content;
            editor.readOnly = false; // ç¡®ä¿å†…å®¹å¯ç¼–è¾‘
            updatePreview();

            document.getElementById('list-view').style.display = 'none';
            document.getElementById('editor-view').style.display = 'block';
            // æ˜¾ç¤ºå¯¼èˆªæ ä¸­çš„æ¨¡å¼åˆ‡æ¢æŒ‰é’®
            document.getElementById('mode-buttons').style.display = 'flex';
            switchMode('edit'); // ç¡®ä¿è¿›å…¥ç¼–è¾‘æ¨¡å¼

            // æ˜¾ç¤ºæ‰€æœ‰ç¼–è¾‘æ§ä»¶
            showEditorControls();
            showFooterControls();
            showNavMenu();

            isShareMode = false; // ç¡®ä¿ä¸æ˜¯åˆ†äº«æ¨¡å¼

            // æ›´æ–°å‘å¸ƒæŒ‰é’®çŠ¶æ€
            updatePublishButton();

            // æ˜¾ç¤ºä¾§è¾¹å¯¼èˆªæ 
            const tocContainer = document.getElementById('toc-container');
            tocContainer.classList.add('show');
        }

        // åˆ‡æ¢å‘å¸ƒçŠ¶æ€
        function togglePublish() {
            if (!currentDocId) return;

            const doc = documents.find(d => d.id === currentDocId);
            if (!doc) return;

            // åˆ‡æ¢å‘å¸ƒçŠ¶æ€
            doc.published = !doc.published;
            // æ›´æ–°æ›´æ–°æ—¶é—´
            doc.updated_at = new Date().toISOString();

            // æ›´æ–°æŒ‰é’®æ˜¾ç¤º
            updatePublishButton();

            // ä¿å­˜åˆ° Supabase
            saveDocuments();

            // æ˜¾ç¤ºæç¤ºä¿¡æ¯
            alert(doc.published ? 'æ–‡æ¡£å·²å‘å¸ƒåˆ°åšå®¢' : 'æ–‡æ¡£å·²ä»åšå®¢æ’¤ä¸‹');
        }

        // æ›´æ–°å‘å¸ƒæŒ‰é’®çŠ¶æ€
        function updatePublishButton() {
            const publishBtn = document.getElementById('publish-btn');
            if (!publishBtn) return;

            const doc = documents.find(d => d.id === currentDocId);
            if (doc && doc.published) {
                publishBtn.textContent = 'ä»åšå®¢æ’¤ä¸‹';
                publishBtn.classList.add('published');
            } else {
                publishBtn.textContent = 'å‘å¸ƒäºåšå®¢';
                publishBtn.classList.remove('published');
            }
        }

        // è¿”å›æ–‡æ¡£åˆ—è¡¨
        function goBackToList() {
            currentDocId = null;
            document.getElementById('editor-view').style.display = 'none';
            document.getElementById('list-view').style.display = 'block';
            renderDocList();
            // éšè—å¯¼èˆªæ ä¸­çš„æ¨¡å¼åˆ‡æ¢æŒ‰é’®
            document.getElementById('mode-buttons').style.display = 'none';
            // é‡ç½®åˆ†äº«æ¨¡å¼çŠ¶æ€
            isShareMode = false;
            // ç¡®ä¿ç¼–è¾‘å™¨å’Œæ ‡é¢˜è¾“å…¥æ¡†éƒ½æ˜¯å¯ç¼–è¾‘çŠ¶æ€ï¼ˆä»¥ä¾¿ä¸‹æ¬¡æ‰“å¼€æ–‡æ¡£æ—¶æ­£å¸¸ï¼‰
            const titleInput = document.getElementById('editor-title');
            const editor = document.getElementById('editor');
            if (titleInput) {
                titleInput.readOnly = false;
                titleInput.style.display = 'block'; // æ¢å¤æ ‡é¢˜è¾“å…¥æ¡†æ˜¾ç¤º
            }
            if (editor) editor.readOnly = false;

            // éšè—ä¾§è¾¹å¯¼èˆªæ 
            const tocContainer = document.getElementById('toc-container');
            tocContainer.classList.remove('show');
        }

        // åˆ‡æ¢ç¼–è¾‘/é¢„è§ˆæ¨¡å¼
        function switchMode(mode) {
            const modeBtns = document.querySelectorAll('.mode-btn');
            modeBtns.forEach(btn => btn.classList.remove('active'));

            if (mode === 'edit') {
                document.querySelector('.edit-btn').classList.add('active');
                document.getElementById('editor').style.display = 'block';
                document.getElementById('preview').style.display = 'none';
            } else {
                document.querySelector('.preview-btn').classList.add('active');
                updatePreview();
                document.getElementById('editor').style.display = 'none';
                document.getElementById('preview').style.display = 'block';
            }
        }

        // é…ç½® marked åº“ï¼Œå…è®¸è§£æ HTML å’Œæ·»åŠ å›¾ç‰‡æ ·å¼
        marked.setOptions({
            breaks: true,
            gfm: true,
            sanitize: false,  // å…è®¸ HTML æ ‡ç­¾
            mangle: false
        });

        // æ‹–æ‹½äº‹ä»¶å¤„ç†
        const editor = document.getElementById('editor');

        // é˜²æ­¢æµè§ˆå™¨é»˜è®¤æ‹–æ‹½è¡Œä¸º
        editor.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.classList.add('dragover');
        });

        editor.addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');
        });

        editor.addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');

            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].type.startsWith('image/')) {
                const file = files[0];
                const fileName = file.name;
                const imageUrl = URL.createObjectURL(file);

                const cursorPos = editor.selectionStart;
                const textBefore = editor.value.substring(0, cursorPos);
                const textAfter = editor.value.substring(cursorPos);

                // æ’å…¥ HTML img æ ‡ç­¾
                const imgTag = `<img alt="${fileName}" src="${imageUrl}" />\n\n`;
                editor.value = textBefore + imgTag + textAfter;

                // ç§»åŠ¨å…‰æ ‡åˆ°å›¾ç‰‡æ’å…¥åçš„ä½ç½®
                editor.selectionStart = editor.selectionEnd = cursorPos + imgTag.length;
                editor.focus();

                // æ›´æ–°é¢„è§ˆ
                updatePreview();
            }
        });

        // ç”Ÿæˆç›®å½•
        function generateTableOfContents() {
            const preview = document.getElementById('preview');
            const tocList = document.getElementById('toc-list');
            const tocContainer = document.getElementById('toc-container');

            // æ¸…ç©ºç°æœ‰ç›®å½•
            tocList.innerHTML = '';

            // æŸ¥æ‰¾æ‰€æœ‰æ ‡é¢˜
            const headings = preview.querySelectorAll('h1, h2, h3');

            if (headings.length === 0) {
                // æ²¡æœ‰æ ‡é¢˜æ—¶éšè—ç›®å½•
                tocContainer.classList.remove('show');
                return;
            }

            // ç”Ÿæˆç›®å½•é¡¹
            headings.forEach((heading, index) => {
                // ä¸ºæ ‡é¢˜æ·»åŠ å”¯ä¸€çš„ id
                const headingId = `heading-${index}`;
                heading.id = headingId;

                // åˆ›å»ºç›®å½•é¡¹
                const li = document.createElement('li');
                li.className = 'toc-item';

                // æ ¹æ®æ ‡é¢˜çº§åˆ«è®¾ç½®æ ·å¼
                const level = parseInt(heading.tagName.charAt(1));

                // è®¾ç½®ä¸åŒçº§åˆ«çš„ç¼©è¿›
                if (level === 1) {
                    li.style.paddingLeft = '0';
                } else if (level === 2) {
                    li.style.paddingLeft = '1rem';
                } else if (level === 3) {
                    li.style.paddingLeft = '2rem';
                }

                // æ£€æŸ¥å½“å‰æ ‡é¢˜æ˜¯å¦æœ‰å­æ ‡é¢˜
                const hasSubheadings = checkForSubheadings(headings, index, level);

                // ä¸ºh1å’Œh2æ ‡é¢˜é¢„ç•™ä¸‰è§’å½¢æŒ‡ç¤ºå™¨çš„ä½ç½®ï¼Œç¡®ä¿åŒä¸€çº§æ ‡é¢˜èµ·å§‹ä½ç½®ç›¸åŒ
                if (level < 3) {
                    if (hasSubheadings) {
                        // æœ‰å­æ ‡é¢˜çš„h1å’Œh2æ ‡é¢˜æ˜¾ç¤ºå°ä¸‰è§’
                        const triangle = document.createElement('span');
                        triangle.className = 'toc-triangle';
                        triangle.innerHTML = 'â–¼'; // æœ‰å­æ ‡é¢˜é»˜è®¤å±•å¼€
                        triangle.style.marginRight = '0.5rem';
                        triangle.style.fontSize = '0.8rem';
                        triangle.style.color = 'var(--secondary-color)';
                        triangle.style.cursor = 'pointer';

                        // æ·»åŠ ä¸‰è§’ç‚¹å‡»äº‹ä»¶
                        triangle.addEventListener('click', (e) => {
                            e.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡
                            toggleSubheadings(li, level);
                        });

                        li.appendChild(triangle);
                    } else {
                        // æ²¡æœ‰å­æ ‡é¢˜çš„h1å’Œh2æ ‡é¢˜æ·»åŠ å ä½ç©ºé—´ï¼Œä»¥ä¿æŒèµ·å§‹ä½ç½®ä¸€è‡´
                        const placeholder = document.createElement('span');
                        placeholder.style.marginRight = '1.1rem'; // ä¸ä¸‰è§’å½¢å®½åº¦+è¾¹è·ç›¸åŒ
                        li.appendChild(placeholder);
                    }
                }

                // åˆ›å»ºæ–‡æœ¬èŠ‚ç‚¹
                const textNode = document.createTextNode(heading.textContent);
                li.appendChild(textNode);
                li.addEventListener('click', () => handleTocClick(headingId));
                tocList.appendChild(li);
            });

        // æ£€æŸ¥å½“å‰æ ‡é¢˜æ˜¯å¦æœ‰å­æ ‡é¢˜
        function checkForSubheadings(headings, index, level) {
            for (let i = index + 1; i < headings.length; i++) {
                const nextLevel = parseInt(headings[i].tagName.charAt(1));
                if (nextLevel > level) {
                    return true;
                } else if (nextLevel <= level) {
                    break;
                }
            }
            return false;
        }

            // æ˜¾ç¤ºç›®å½•
            tocContainer.classList.add('show');
        }

        // åˆ‡æ¢å°æ ‡é¢˜çš„æ˜¾ç¤º/éšè—
        function toggleSubheadings(li, level) {
            const triangle = li.querySelector('.toc-triangle');
            if (!triangle) return;

            // åˆ‡æ¢ä¸‰è§’æ–¹å‘
            if (triangle.innerHTML === 'â–¶') {
                triangle.innerHTML = 'â–¼'; // å‘ä¸‹çš„ä¸‰è§’ï¼Œå±•å¼€çŠ¶æ€
            } else {
                triangle.innerHTML = 'â–¶'; // å‘å³çš„ä¸‰è§’ï¼Œæ”¶èµ·çŠ¶æ€
            }

            // æŸ¥æ‰¾å½“å‰æ ‡é¢˜åçš„æ‰€æœ‰å°æ ‡é¢˜
            let nextLi = li.nextElementSibling;
            while (nextLi) {
                // è·å–ä¸‹ä¸€ä¸ªliä¸­çš„æ ‡é¢˜çº§åˆ«
                const nextHeading = getHeadingLevel(nextLi);
                if (nextHeading > level) {
                    nextLi.style.display = nextLi.style.display === 'none' ? 'block' : 'none';
                } else {
                    break; // é‡åˆ°åŒçº§æˆ–æ›´é«˜çº§åˆ«çš„æ ‡é¢˜æ—¶åœæ­¢
                }
                nextLi = nextLi.nextElementSibling;
            }
        }

        // è·å–ç›®å½•é¡¹å¯¹åº”çš„æ ‡é¢˜çº§åˆ«
        function getHeadingLevel(tocItem) {
            // æ ¹æ®ç›®å½•é¡¹çš„ç¼©è¿›åˆ¤æ–­æ ‡é¢˜çº§åˆ«
            const style = window.getComputedStyle(tocItem);
            const paddingLeft = parseInt(style.paddingLeft);
            if (paddingLeft === 0) {
                return 1; // h1 æ— ç¼©è¿›
            } else if (paddingLeft === 16) {
                return 2; // h2 ç¼©è¿›1rem (16px)
            } else if (paddingLeft === 32) {
                return 3; // h3 ç¼©è¿›2rem (32px)
            }
            return 1; // é»˜è®¤è¿”å›1
        }

        // å¤„ç†ç›®å½•ç‚¹å‡»äº‹ä»¶
        function handleTocClick(headingId) {
            const heading = document.getElementById(headingId);
            if (heading) {
                // è®¡ç®—æ»šåŠ¨ä½ç½®ï¼Œè€ƒè™‘å›ºå®šå¯¼èˆªæ çš„é«˜åº¦
                const offsetTop = heading.offsetTop - 100;
                window.scrollTo({
                    top: offsetTop,
                    behavior: 'smooth'
                });
            }
        }

        // æ›´æ–°é¢„è§ˆ
        function updatePreview() {
            const content = document.getElementById('editor').value;
            const preview = document.getElementById('preview');
            const title = document.getElementById('editor-title').value;

            // æ£€æŸ¥å½“å‰æ˜¯å¦æ˜¯é¢„è§ˆæ¨¡å¼æˆ–åˆ†äº«æ¨¡å¼
            const isPreviewMode = document.querySelector('.preview-btn.active') !== null;
            if ((isPreviewMode || isShareMode) && title) {
                // é¢„è§ˆæ¨¡å¼æˆ–åˆ†äº«æ¨¡å¼ä¸‹ï¼Œå°†æ ‡é¢˜æ”¾åˆ°å†…å®¹æ¡†ä¸­
                preview.innerHTML = `
                    <h1 style="font-size: 3rem; font-weight: 700; color: var(--primary-color); margin-bottom: 1.5rem; margin-top: -1rem; font-family: 'Noto Serif SC', 'Times New Roman', serif;">${title}</h1>
                    ${marked.parse(content) || '<p style="color: var(--secondary-color); opacity: 0.5;">æš‚æ— å†…å®¹</p>'}
                `;
            } else {
                // ç¼–è¾‘æ¨¡å¼ä¸‹ï¼Œåªæ˜¾ç¤ºå†…å®¹
                preview.innerHTML = marked.parse(content) || '<p style="color: var(--secondary-color); opacity: 0.5;">æš‚æ— å†…å®¹</p>';
            }

            // ç”Ÿæˆç›®å½•
            generateTableOfContents();
        }

        // åˆ é™¤æ–‡æ¡£
        function deleteDocument() {
            if (!currentDocId) return;

            if (confirm('ç¡®å®šè¦åˆ é™¤å½“å‰æ–‡æ¡£å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                // ç›´æ¥è°ƒç”¨ Supabase çš„åˆ é™¤ API åˆ é™¤æ–‡æ¡£
                supabase.from('documents').delete(currentDocId)
                    .then(() => {
                        // ä»æœ¬åœ°æ•°ç»„ä¸­åˆ é™¤æ–‡æ¡£
                        documents = documents.filter(doc => doc.id !== currentDocId);
                        goBackToList();
                        alert('æ–‡æ¡£åˆ é™¤æˆåŠŸ');
                    })
                    .catch(error => {
                        console.error('åˆ é™¤æ–‡æ¡£å¤±è´¥:', error);
                        alert('åˆ é™¤æ–‡æ¡£å¤±è´¥ï¼Œè¯·é‡è¯•');
                    });
            }
        }

        // åˆ†äº«æ¨¡å¼çŠ¶æ€
        let isShareMode = false;
        const SHARE_PASSWORD = atob('MTQ3ODk2MzI1');

        // åˆ‡æ¢åˆ†äº«æ¨¡å¼
        function toggleShareMode() {
            if (!isShareMode) {
                // è¿›å…¥åˆ†äº«æ¨¡å¼
                const shareUrl = generateShareUrl(currentDocId);
                // æ˜¾ç¤ºåˆ†äº«é“¾æ¥
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.innerHTML = `
                    <div class="modal-content">
                        <div class="modal-title">åˆ†äº«æ–‡æ¡£</div>
                        <p style="color: var(--secondary-color); margin-bottom: 1rem;">å¤åˆ¶ä»¥ä¸‹é“¾æ¥åˆ†äº«ç»™ä»–äººï¼š</p>
                        <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                            <input type="text" id="share-url" class="modal-input" value="${shareUrl}" readonly style="flex: 1;">
                            <button class="btn-confirm" onclick="copyShareUrl()">å¤åˆ¶</button>
                        </div>
                        <div class="modal-buttons">
                            <button class="btn-cancel" onclick="hideShareModal()">å…³é—­</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            } else {
                // é€€å‡ºåˆ†äº«æ¨¡å¼
                showEditorControls(); // æ˜¾ç¤ºé¡¶éƒ¨ç¼–è¾‘æ§ä»¶
                showFooterControls(); // æ˜¾ç¤ºåº•éƒ¨ç¼–è¾‘æ§ä»¶
                showNavMenu(); // æ˜¾ç¤ºå¯¼èˆªèœå•
                isShareMode = false;

                // ç¡®ä¿æ ‡é¢˜å’Œå†…å®¹å¯ç¼–è¾‘
                const titleInput = document.getElementById('editor-title');
                const editor = document.getElementById('editor');
                titleInput.readOnly = false;
                editor.readOnly = false;

                // æ˜¾ç¤ºç¼–è¾‘å’Œé¢„è§ˆæŒ‰é’®
                const editBtn = document.querySelector('.edit-btn');
                const previewBtn = document.querySelector('.preview-btn');
                if (editBtn) editBtn.style.display = 'block';
                if (previewBtn) previewBtn.style.display = 'block';

                // åˆ‡æ¢åˆ°ç¼–è¾‘æ¨¡å¼
                switchMode('edit');
            }
        }

        // éšè—åˆ†äº«æ¨¡æ€æ¡†
        function hideShareModal() {
            const modal = document.querySelector('.modal.active');
            if (modal) {
                modal.remove();
            }
        }

        // å¤åˆ¶åˆ†äº«é“¾æ¥
        function copyShareUrl() {
            const shareUrlInput = document.getElementById('share-url');

            // ä½¿ç”¨ç°ä»£çš„ Clipboard API
            if (navigator.clipboard && window.isSecureContext) {
                // ç°ä»£æµè§ˆå™¨æ”¯æŒçš„æ–¹å¼
                navigator.clipboard.writeText(shareUrlInput.value).then(() => {
                    alert('åˆ†äº«é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                }).catch(err => {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                    fallbackCopy(shareUrlInput);
                });
            } else {
                // æ—§æµè§ˆå™¨çš„ fallback æ–¹å¼
                fallbackCopy(shareUrlInput);
            }
        }

        // æ—§æµè§ˆå™¨çš„å¤åˆ¶æ–¹æ³•
        function fallbackCopy(inputElement) {
            try {
                inputElement.select();
                const successful = document.execCommand('copy');
                if (successful) {
                    alert('åˆ†äº«é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                } else {
                    alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¹¶å¤åˆ¶é“¾æ¥');
                }
            } catch (err) {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¹¶å¤åˆ¶é“¾æ¥');
            }
        }

        // éšè—åº•éƒ¨ç¼–è¾‘æ§ä»¶
        function hideFooterControls() {
            document.querySelectorAll('.btn-delete, .btn-share, .btn-save').forEach(btn => {
                btn.style.display = 'none';
            });
        }

        // æ˜¾ç¤ºåº•éƒ¨ç¼–è¾‘æ§ä»¶
        function showFooterControls() {
            document.querySelectorAll('.btn-delete, .btn-share, .btn-save').forEach(btn => {
                btn.style.display = 'block';
            });
        }

        // éšè—ç¼–è¾‘æ§ä»¶
        function hideEditorControls() {
            document.querySelectorAll('.btn-back, .btn-delete, .btn-save, .btn-publish').forEach(btn => {
                btn.style.display = 'none';
            });
        }

        // æ˜¾ç¤ºç¼–è¾‘æ§ä»¶
        function showEditorControls() {
            document.querySelectorAll('.btn-back, .btn-delete, .btn-save, .btn-publish').forEach(btn => {
                btn.style.display = 'block';
            });
        }

        // éšè—å¯¼èˆªèœå•
        function hideNavMenu() {
            document.querySelector('.nav-menu').style.display = 'none';
        }

        // æ˜¾ç¤ºå¯¼èˆªèœå•
        function showNavMenu() {
            document.querySelector('.nav-menu').style.display = 'flex';
        }

        // è¿›å…¥ç¼–è¾‘é¡µé¢æç¤ºæ¨¡æ€æ¡†
        function showEditPromptModal() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-title">è¿›å…¥ç¼–è¾‘é¡µé¢</div>
                    <p style="color: var(--secondary-color); margin-bottom: 1rem;">æ‚¨å°†è¿›å…¥ç¼–è¾‘é¡µé¢ï¼Œä¿®æ”¹åçš„å†…å®¹å°†ä½œä¸ºä¿®æ­£ç‰ˆæœ¬ä¿å­˜ã€‚</p>
                    <div class="modal-buttons">
                        <button class="btn-cancel" onclick="hideEditPromptModal()">å–æ¶ˆ</button>
                        <button class="btn-confirm" onclick="goToEditPage()">ç¡®å®š</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // éšè—è¿›å…¥ç¼–è¾‘é¡µé¢æç¤ºæ¨¡æ€æ¡†
        function hideEditPromptModal() {
            const modal = document.querySelector('.modal.active');
            if (modal) {
                modal.remove();
            }
        }

        // è·³è½¬åˆ°ç¼–è¾‘é¡µé¢
        function goToEditPage() {
            hideEditPromptModal();
            const doc = documents.find(d => d.id === currentDocId);
            if (doc) {
                // ä¼ é€’æ–‡æ¡£ä¿¡æ¯åˆ°ç¼–è¾‘é¡µé¢ï¼Œå¯ä»¥é€šè¿‡URLå‚æ•°æˆ–localStorage
                localStorage.setItem('editDoc', JSON.stringify(doc));
                window.open('wikiedit.html', '_blank');
            }
        }

        // è·³è½¬åˆ°ä¿®æ­£åˆ—è¡¨é¡µé¢
        function showCorrectionList() {
            window.location.href = 'wikicorrection.html';
        }

        // å¯†ç éªŒè¯æ¨¡æ€æ¡†
        function showPasswordModal() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-title">ç¼–è¾‘å¯†ç </div>
                    <input type="password" id="password-input" class="modal-input" placeholder="è¯·è¾“å…¥ç¼–è¾‘å¯†ç ">
                    <div class="modal-buttons">
                        <button class="btn-cancel" onclick="hidePasswordModal()">å–æ¶ˆ</button>
                        <button class="btn-confirm" onclick="verifyPassword()">ç¡®è®¤</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // éšè—å¯†ç éªŒè¯æ¨¡æ€æ¡†
        function hidePasswordModal() {
            const modal = document.querySelector('.modal.active');
            if (modal) {
                modal.remove();
            }
        }

        // éªŒè¯å¯†ç 
        function verifyPassword() {
            const password = document.getElementById('password-input').value;
            if (password === SHARE_PASSWORD) {
                hidePasswordModal();
                toggleShareMode(); // é€€å‡ºåˆ†äº«æ¨¡å¼
            } else {
                alert('å¯†ç é”™è¯¯');
            }
        }

        // é‡å†™ switchMode å‡½æ•°ï¼Œåœ¨åˆ†äº«æ¨¡å¼ä¸‹ç‚¹å‡»ç¼–è¾‘æŒ‰é’®æ—¶æ˜¾ç¤ºè¿›å…¥ç¼–è¾‘é¡µé¢çš„æç¤º
        function switchMode(mode) {
            // å¦‚æœæ˜¯åˆ†äº«æ¨¡å¼ä¸”ç‚¹å‡»çš„æ˜¯ç¼–è¾‘æŒ‰é’®
            if (isShareMode && mode === 'edit') {
                showEditPromptModal();
                return;
            }

            const modeBtns = document.querySelectorAll('.mode-btn');
            modeBtns.forEach(btn => btn.classList.remove('active'));

            if (mode === 'edit') {
                document.querySelector('.edit-btn').classList.add('active');
                document.getElementById('editor').style.display = 'block';
                document.getElementById('preview').style.display = 'none';
                // ç¼–è¾‘æ¨¡å¼ä¸‹æ˜¾ç¤ºæ ‡é¢˜è¾“å…¥æ¡†
                document.getElementById('editor-title').style.display = 'block';
                // ç¼–è¾‘æ¨¡å¼ä¸‹æ˜¾ç¤ºè¿”å›æŒ‰é’®
                const backBtn = document.querySelector('.btn-back');
                if (backBtn) backBtn.style.display = 'block';
            } else {
                document.querySelector('.preview-btn').classList.add('active');
                updatePreview();
                document.getElementById('editor').style.display = 'none';
                document.getElementById('preview').style.display = 'block';
                // é¢„è§ˆæ¨¡å¼ä¸‹éšè—æ ‡é¢˜è¾“å…¥æ¡†
                document.getElementById('editor-title').style.display = 'none';
                // é¢„è§ˆæ¨¡å¼ä¸‹éšè—è¿”å›æŒ‰é’®ï¼Œä¿æŒä¸åˆ†äº«é¡µé¢ç›¸åŒçš„é€»è¾‘
                const backBtn = document.querySelector('.btn-back');
                if (backBtn) backBtn.style.display = 'none';
            }
        }

        // ä¿å­˜æ–‡æ¡£
        async function saveDocument() {
            if (!currentDocId) return;

            const doc = documents.find(d => d.id === currentDocId);
            if (!doc) return;

            doc.title = document.getElementById('editor-title').value.trim() || 'æœªå‘½åæ–‡æ¡£';
            doc.content = document.getElementById('editor').value;
            doc.updated_at = new Date().toISOString();

            const result = await saveDocuments();
            alert(result.message);
        }

        // å·¥å…·å‡½æ•°
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };

            return text.replace(/[&<>"]/g, function(m) { return map[m]; });
        }

        function formatDate(isoString) {
            const date = new Date(isoString);
            const now = new Date();
            const diff = now - date;

            if (diff < 60000) { // å°äº1åˆ†é’Ÿ
                return 'åˆšåˆš';
            } else if (diff < 3600000) { // å°äº1å°æ—¶
                return Math.floor(diff / 60000) + 'åˆ†é’Ÿå‰';
            } else if (diff < 86400000) { // å°äº1å¤©
                return Math.floor(diff / 3600000) + 'å°æ—¶å‰';
            } else {
                return date.toLocaleDateString('zh-CN');
            }
        }

        function formatWordCount(content) {
            if (!content) return '0';
            const count = content.trim().split(/\s+/).filter(word => word.length > 0).length;
            return count + (count === 1 ? 'å­—' : 'å­—');
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    </script>
</body>
</html>