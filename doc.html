<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡æ¡£ç®¡ç† - Weatheraintbad</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto Serif SC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* æ–‡æ¡£ç®¡ç†é¡µé¢ç‰¹å®šæ ·å¼ */
        .doc-manager {
            min-height: 100vh;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            position: relative;
            overflow: hidden;
        }

        .doc-manager::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 50%, rgba(250, 167, 85, 0.05) 0%, transparent 70%);
            z-index: 0;
        }

        .doc-content {
            position: relative;
            z-index: 1;
            width: 100%;
            padding: 120px 0 60px;
        }

        /* é¡µé¢å¸ƒå±€å®¹å™¨ */
        .doc-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        /* é¡µé¢æ ‡é¢˜ */
        .doc-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3rem;
        }

        .doc-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            font-family: 'Noto Serif SC', 'Times New Roman', serif;
        }

        /* æ–°å»ºæŒ‰é’® */
        .btn-new {
            background: linear-gradient(135deg, var(--accent-color), #ff9a3c);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(250, 167, 85, 0.3);
        }

        .btn-new:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(250, 167, 85, 0.4);
        }

        .btn-new:active {
            transform: translateY(0);
        }

        /* æ–‡æ¡£åˆ—è¡¨ */
        .doc-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .doc-item {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .doc-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.6s;
        }

        .doc-item:hover::before {
            left: 100%;
        }

        .doc-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            border-color: rgba(250, 167, 85, 0.3);
        }

        .doc-item-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .doc-item-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: var(--secondary-color);
            opacity: 0.7;
        }

        /* ç¼–è¾‘å™¨é¡µé¢ */
        .editor-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 3rem;
        }

        .editor-title-container {
            flex: 1;
            margin-right: 2rem;
        }

        .editor-title-input {
            width: 100%;
            background: transparent;
            border: none;
            color: var(--primary-color);
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 700;
            font-family: 'Times New Roman', 'Noto Serif SC', Times, serif;
            line-height: 1.1;
            letter-spacing: -2px;
            padding: 0;
            margin: 0;
        }

        .editor-title-input::placeholder {
            color: var(--secondary-color);
            opacity: 0.5;
        }

        .editor-title-input:focus {
            outline: none;
        }

        .editor-controls {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .btn-back {
            background: rgba(255, 255, 255, 0.1);
            color: var(--primary-color);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-back:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* åˆ é™¤æŒ‰é’® */
        .btn-delete {
            background: rgba(255, 82, 82, 0.1);
            color: #ff5252;
            border: 1px solid rgba(255, 82, 82, 0.3);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-delete:hover {
            background: rgba(255, 82, 82, 0.2);
            border-color: rgba(255, 82, 82, 0.5);
        }

        /* åˆ†äº«æŒ‰é’® */
        .btn-share {
            background: rgba(76, 175, 80, 0.1);
            color: #4caf50;
            border: 1px solid rgba(76, 175, 80, 0.3);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-share:hover {
            background: rgba(76, 175, 80, 0.2);
            border-color: rgba(76, 175, 80, 0.5);
        }

        /* ä¿å­˜æŒ‰é’® */
        .btn-save {
            background: linear-gradient(135deg, var(--accent-color), #ff9a3c);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(250, 167, 85, 0.3);
        }

        .btn-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(250, 167, 85, 0.4);
        }

        /* æ¨¡å¼åˆ‡æ¢æŒ‰é’®å®¹å™¨ */
        #mode-buttons {
            display: none;
            gap: 0.5rem;
            align-items: center;
        }

        /* æ¨¡å¼åˆ‡æ¢æŒ‰é’® */
        .mode-btn {
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            color: var(--secondary-color);
            padding: 0;
        }

        .mode-btn:hover {
            color: var(--accent-color);
            border-color: var(--accent-color);
        }

        .mode-btn.active {
            color: var(--accent-color);
            border-color: var(--accent-color);
        }

        .mode-btn svg {
            transition: all 0.3s ease;
        }

        .mode-btn.active svg {
            transform: scale(1.1);
        }

        /* ç¼–è¾‘å™¨åŒºåŸŸ */
        .editor-area {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 1.5rem;
            min-height: 500px;
            margin-bottom: 2rem;
        }

        .editor {
            width: 100%;
            min-height: 500px;
            background: transparent;
            border: none;
            color: var(--primary-color);
            font-size: 1rem;
            line-height: 1.6;
            font-family: 'Inter', sans-serif;
            resize: vertical;
        }

        .editor:focus {
            outline: none;
        }

        /* é¢„è§ˆåŒºåŸŸ */
        .preview {
            color: var(--primary-color);
            line-height: 1.6;
        }

        .preview h1, .preview h2, .preview h3 {
            color: var(--accent-color);
            margin-top: 1.5rem;
            margin-bottom: 1rem;
        }

        .preview h1 {
            font-size: 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 0.5rem;
        }

        .preview h2 {
            font-size: 1.5rem;
        }

        .preview h3 {
            font-size: 1.2rem;
        }

        .preview p {
            margin-bottom: 1rem;
        }

        .preview ul, .preview ol {
            margin-bottom: 1rem;
            padding-left: 2rem;
        }

        .preview code {
            background: rgba(0, 0, 0, 0.3);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9rem;
        }

        .preview pre {
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            margin-bottom: 1rem;
        }

        .preview pre code {
            background: transparent;
            padding: 0;
        }

        .preview blockquote {
            border-left: 3px solid var(--accent-color);
            padding-left: 1rem;
            margin-left: 0;
            margin-bottom: 1rem;
            opacity: 0.8;
        }

        .preview table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1rem;
        }

        .preview th, .preview td {
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 0.5rem;
            text-align: left;
        }

        .preview th {
            background: rgba(250, 167, 85, 0.1);
        }

        /* åº•éƒ¨æŒ‰é’®åŒºåŸŸ */
        .editor-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .btn-save {
            background: linear-gradient(135deg, var(--accent-color), #ff9a3c);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(250, 167, 85, 0.3);
        }

        .btn-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(250, 167, 85, 0.4);
        }

        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 1.5rem;
        }

        .modal-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            color: var(--primary-color);
            font-size: 1rem;
            margin-bottom: 1.5rem;
            box-sizing: border-box;
        }

        .modal-input::placeholder {
            color: var(--secondary-color);
            opacity: 0.5;
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        .btn-cancel {
            background: rgba(255, 255, 255, 0.1);
            color: var(--primary-color);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-confirm {
            background: linear-gradient(135deg, var(--accent-color), #ff9a3c);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        /* åŠ è½½çŠ¶æ€ */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            color: var(--secondary-color);
            font-size: 1.2rem;
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--secondary-color);
            opacity: 0.7;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .doc-title {
                font-size: 2rem;
            }

            .doc-list {
                grid-template-columns: 1fr;
            }

            .doc-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .editor-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .editor-title-input {
                width: 100%;
                margin-right: 0;
            }

            .editor-controls {
                width: 100%;
                justify-content: space-between;
            }

            .modal-content {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <a href="index.html" style="text-decoration: none; color: inherit;">Weatheraintbad.com</a>
            </div>
            <ul class="nav-menu">
                <li><a href="dashboard.html">æ•°æ®çœ‹æ¿</a></li>
                <li><a href="doc.html" style="color: var(--accent-color);">æ–‡æ¡£ç®¡ç†</a></li>
            </ul>
            <div class="nav-buttons">
                <!-- æ¨¡å¼åˆ‡æ¢æŒ‰é’®ï¼ˆåªåœ¨ç¼–è¾‘å™¨é¡µé¢æ˜¾ç¤ºï¼‰ -->
                <div id="mode-buttons" style="display: none; gap: 0.5rem; display: none; align-items: center;">
                    <button class="mode-btn edit-btn active" onclick="switchMode('edit')" aria-label="ç¼–è¾‘æ¨¡å¼">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                    </button>
                    <button class="mode-btn preview-btn" onclick="switchMode('preview')" aria-label="é¢„è§ˆæ¨¡å¼">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                    </button>
                </div>
                <button id="theme-toggle" class="theme-toggle" aria-label="åˆ‡æ¢ä¸»é¢˜">
                    <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                    <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </button>
            </div>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <section class="doc-manager">
        <div class="doc-content">
            <div class="doc-container">
                <!-- æ–‡æ¡£åˆ—è¡¨é¡µé¢ -->
                <div id="list-view">
                    <div class="doc-header">
                        <h1 class="doc-title">æ–‡æ¡£ç®¡ç†</h1>
                        <button class="btn-new" onclick="showCreateModal()">æ–°å»ºæ–‡æ¡£</button>
                    </div>
                    <div id="doc-list" class="doc-list">
                        <!-- æ–‡æ¡£åˆ—è¡¨å°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <div id="empty-state" class="empty-state" style="display: none;">
                        <div class="empty-state-icon">ğŸ“„</div>
                        <div>æš‚æ— æ–‡æ¡£ï¼Œç‚¹å‡»"æ–°å»ºæ–‡æ¡£"å¼€å§‹åˆ›å»º</div>
                    </div>
                </div>

                <!-- ç¼–è¾‘å™¨é¡µé¢ -->
                <div id="editor-view" style="display: none;">
                    <div class="editor-container">
                        <!-- æ ‡é¢˜åŒºåŸŸ -->
                        <div class="editor-header">
                            <div class="editor-title-container">
                                <input type="text" id="editor-title" class="editor-title-input" placeholder="è¯·è¾“å…¥æ–‡æ¡£æ ‡é¢˜">
                            </div>
                            <div class="editor-controls">
                                <button class="btn-back" onclick="goBackToList()">â† è¿”å›</button>
                            </div>
                        </div>

                        <div class="editor-area">
                            <textarea id="editor" class="editor" placeholder="è¯·è¾“å…¥ Markdown å†…å®¹..."></textarea>
                            <div id="preview" class="preview" style="display: none;"></div>
                        </div>

                        <div class="editor-footer">
                            <button class="btn-delete" onclick="deleteDocument()">åˆ é™¤</button>
                            <button class="btn-share" onclick="toggleShareMode()">åˆ†äº«</button>
                            <button class="btn-save" onclick="saveDocument()">ä¿å­˜æ–‡æ¡£</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- æ–°å»ºæ–‡æ¡£æ¨¡æ€æ¡† -->
    <div id="create-modal" class="modal">
        <div class="modal-content">
            <div class="modal-title">æ–°å»ºæ–‡æ¡£</div>
            <input type="text" id="new-doc-title" class="modal-input" placeholder="è¯·è¾“å…¥æ–‡æ¡£æ ‡é¢˜">
            <div class="modal-buttons">
                <button class="btn-cancel" onclick="hideCreateModal()">å–æ¶ˆ</button>
                <button class="btn-confirm" onclick="createDocument()">åˆ›å»º</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        // æ–‡æ¡£æ•°æ®å­˜å‚¨
        let documents = [];
        let currentDocId = null;
        // Supabase é…ç½®
        // è¯·åœ¨ https://supabase.com/ åˆ›å»ºé¡¹ç›®å¹¶è·å–ä»¥ä¸‹ä¿¡æ¯
        const SUPABASE_URL = 'https://wyoofofxviolwdebkpkt.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_TOTiug5k7UCGYLeLib0cUw_Vqm06ZyC';

        // åˆå§‹åŒ– Supabase å®¢æˆ·ç«¯
        const supabase = SUPABASE_URL && SUPABASE_ANON_KEY ? supabase = {
            url: SUPABASE_URL,
            anonKey: SUPABASE_ANON_KEY,
            async from(table) {
                return {
                    async select(query = '*') {
                        const response = await fetch(`${SUPABASE_URL}/rest/v1/${table}?${new URLSearchParams({ select: query })}`, {
                            headers: {
                                'apikey': SUPABASE_ANON_KEY,
                                'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                                'Content-Type': 'application/json',
                                'Accept': 'application/json'
                            }
                        });
                        if (!response.ok) throw new Error(`Select failed: ${response.status}`);
                        return { data: await response.json(), error: null };
                    },
                    async insert(data) {
                        const response = await fetch(`${SUPABASE_URL}/rest/v1/${table}`, {
                            method: 'POST',
                            headers: {
                                'apikey': SUPABASE_ANON_KEY,
                                'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                                'Content-Type': 'application/json',
                                'Accept': 'application/json',
                                'Prefer': 'return=representation'
                            },
                            body: JSON.stringify(data)
                        });
                        if (!response.ok) throw new Error(`Insert failed: ${response.status}`);
                        return { data: await response.json(), error: null };
                    },
                    async update(data) {
                        const response = await fetch(`${SUPABASE_URL}/rest/v1/${table}`, {
                            method: 'PATCH',
                            headers: {
                                'apikey': SUPABASE_ANON_KEY,
                                'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                                'Content-Type': 'application/json',
                                'Accept': 'application/json',
                                'Prefer': 'return=representation'
                            },
                            body: JSON.stringify(data)
                        });
                        if (!response.ok) throw new Error(`Update failed: ${response.status}`);
                        return { data: await response.json(), error: null };
                    },
                    async delete() {
                        const response = await fetch(`${SUPABASE_URL}/rest/v1/${table}`, {
                            method: 'DELETE',
                            headers: {
                                'apikey': SUPABASE_ANON_KEY,
                                'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                                'Content-Type': 'application/json',
                                'Accept': 'application/json'
                            }
                        });
                        if (!response.ok) throw new Error(`Delete failed: ${response.status}`);
                        return { data: null, error: null };
                    }
                };
            }
        } : null;

        // ç”Ÿæˆå”¯ä¸€æ ‡è¯†ç¬¦
        function generateSlug() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        // ä» GitHub Gist åŠ è½½æ–‡æ¡£
        async function loadDocumentsFromGist() {
            if (!GIST_ID) {
                console.warn('æœªé…ç½® GitHub Gist IDï¼Œä½¿ç”¨æœ¬åœ°å­˜å‚¨');
                loadDocumentsFromLocalStorage();
                return;
            }

            try {
                const response = await fetch(`https://api.github.com/gists/${GIST_ID}`, {
                    headers: GITHUB_TOKEN ? {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json'
                    } : {}
                });

                if (!response.ok) {
                    throw new Error(`Failed to load gist: ${response.status}`);
                }

                const data = await response.json();
                const file = Object.values(data.files)[0];

                if (file && file.content) {
                    documents = JSON.parse(file.content);
                    console.log('ä» GitHub Gist åŠ è½½äº†', documents.length, 'ä¸ªæ–‡æ¡£');
                } else {
                    console.warn('Gist ä¸­æ²¡æœ‰æ–‡æ¡£ï¼Œåˆå§‹åŒ–ç©ºæ•°ç»„');
                    documents = [];
                }
            } catch (error) {
                console.error('ä» GitHub Gist åŠ è½½æ–‡æ¡£å¤±è´¥:', error);
                // å¤±è´¥æ—¶å›é€€åˆ°æœ¬åœ°å­˜å‚¨
                loadDocumentsFromLocalStorage();
            }
        }

        // ä¿å­˜æ–‡æ¡£åˆ° GitHub Gist
        async function saveDocumentsToGist() {
            if (!GIST_ID) {
                console.warn('æœªé…ç½® GitHub Gist IDï¼Œä½¿ç”¨æœ¬åœ°å­˜å‚¨');
                saveDocumentsToLocalStorage();
                return;
            }

            try {
                const response = await fetch(`https://api.github.com/gists/${GIST_ID}`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        files: {
                            'documents.json': {
                                content: JSON.stringify(documents, null, 2)
                            }
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error(`Failed to save gist: ${response.status}`);
                }

                console.log('æ–‡æ¡£å·²ä¿å­˜åˆ° GitHub Gist');
            } catch (error) {
                console.error('ä¿å­˜æ–‡æ¡£åˆ° GitHub Gist å¤±è´¥:', error);
                // å¤±è´¥æ—¶å›é€€åˆ°æœ¬åœ°å­˜å‚¨
                saveDocumentsToLocalStorage();
            }
        }

        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ–‡æ¡£ï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰
        function loadDocumentsFromLocalStorage() {
            const stored = localStorage.getItem('weatheraintbad_documents');
            documents = stored ? JSON.parse(stored) : [];
            console.log('ä»æœ¬åœ°å­˜å‚¨åŠ è½½äº†', documents.length, 'ä¸ªæ–‡æ¡£');
        }

        // ä¿å­˜æ–‡æ¡£åˆ°æœ¬åœ°å­˜å‚¨ï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰
        function saveDocumentsToLocalStorage() {
            localStorage.setItem('weatheraintbad_documents', JSON.stringify(documents));
        }

        // ç»Ÿä¸€çš„åŠ è½½æ–‡æ¡£å‡½æ•°
        function loadDocuments() {
            loadDocumentsFromGist();
        }

        // ç»Ÿä¸€çš„ä¿å­˜æ–‡æ¡£å‡½æ•°
        function saveDocuments() {
            saveDocumentsToGist();
        }

        // è§£æ URL è·¯ç”±ï¼ˆæ”¯æŒå“ˆå¸Œè·¯ç”±ï¼‰
        function parseUrl() {
            const hashPath = window.location.hash.slice(1); // å»é™¤ #
            const docMatch = hashPath.match(/^\/doc\/([a-f0-9-]+)$/);

            if (docMatch) {
                const slug = docMatch[1];
                return { type: 'doc', slug };
            }

            return { type: 'list' };
        }

        // ç”Ÿæˆåˆ†äº«é“¾æ¥ï¼ˆä½¿ç”¨å“ˆå¸Œè·¯ç”±ï¼‰
        function generateShareUrl(docId) {
            const doc = documents.find(d => d.id === docId);
            if (!doc) return null;

            // å¦‚æœæ–‡æ¡£æ²¡æœ‰ slugï¼Œç”Ÿæˆä¸€ä¸ª
            if (!doc.slug) {
                doc.slug = generateSlug();
                saveDocuments();
            }

            return window.location.origin + '/doc.html#/doc/' + doc.slug;
        }

        // ç›‘å¬ hash å˜åŒ–
        window.addEventListener('hashchange', () => {
            const route = parseUrl();
            if (route.type === 'doc') {
                const doc = documents.find(d => d.slug === route.slug);
                if (doc) {
                    isShareMode = true;
                    currentDocId = doc.id;
                    document.getElementById('editor-title').value = doc.title;
                    document.getElementById('editor').value = doc.content;
                    updatePreview();

                    document.getElementById('list-view').style.display = 'none';
                    document.getElementById('editor-view').style.display = 'block';
                    document.getElementById('mode-buttons').style.display = 'flex';
                    switchMode('preview');
                    hideEditorControls();
                    hideFooterControls();
                    hideNavMenu();
                } else {
                    alert('æ–‡æ¡£ä¸å­˜åœ¨');
                }
            } else {
                // æ˜¾ç¤ºæ–‡æ¡£åˆ—è¡¨
                goBackToList();
            }
        });

        // åè°ƒè¯•ä»£ç 
        (function() {
            // ç¦æ­¢å³é”®èœå•
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
            });

            // ç¦æ­¢é€‰æ‹©æ–‡æœ¬ï¼ˆä½†å…è®¸åˆ†äº«é“¾æ¥è¾“å…¥æ¡†é€‰æ‹©ï¼‰
            document.addEventListener('selectstart', function(e) {
                if (e.target && e.target.id === 'share-url') {
                    return; // å…è®¸åˆ†äº«é“¾æ¥è¾“å…¥æ¡†é€‰æ‹©
                }
                e.preventDefault();
            });

            // ç¦æ­¢å¤åˆ¶ï¼ˆä½†å…è®¸åˆ†äº«é“¾æ¥å¤åˆ¶ï¼‰
            document.addEventListener('copy', function(e) {
                if (e.target && e.target.id === 'share-url') {
                    return; // å…è®¸åˆ†äº«é“¾æ¥å¤åˆ¶
                }
                e.preventDefault();
            });

            // ç¦æ­¢å‰ªåˆ‡
            document.addEventListener('cut', function(e) {
                e.preventDefault();
            });

            // ç¦æ­¢ç²˜è´´
            document.addEventListener('paste', function(e) {
                e.preventDefault();
            });

            // æ£€æµ‹è°ƒè¯•å™¨
            function detectDebugger() {
                const start = performance.now();
                debugger;
                const end = performance.now();
                return end - start > 100; // è°ƒè¯•å™¨æ‰“å¼€æ—¶ï¼Œæ—¶é—´å·®ä¼šå¾ˆå¤§
            }

            // æ£€æµ‹æ§åˆ¶å°æ˜¯å¦æ‰“å¼€
            function detectConsole() {
                const start = performance.now();
                console.log('');
                return performance.now() - start > 10;
            }

            // å®šæ—¶æ£€æµ‹
            setInterval(function() {
                if (detectDebugger() || detectConsole()) {
                    document.body.innerHTML = `
                        <div style="display: flex; justify-content: center; align-items: center; height: 100vh; color: var(--secondary-color); font-size: 1.5rem;">
                            æ£€æµ‹åˆ°è°ƒè¯•è¡Œä¸ºï¼Œé¡µé¢å·²é”å®š
                        </div>
                    `;
                }
            }, 1000);
        })();

        // é¡µé¢è®¿é—®å¯†ç 
        const ACCESS_PASSWORD = atob('MTQ3ODk2MzI1');
        let isPageAccessible = false;

        // æ˜¾ç¤ºè®¿é—®å¯†ç å¼¹çª—
        function showAccessPasswordModal() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-title">è®¿é—®å¯†ç </div>
                    <input type="password" id="access-password-input" class="modal-input" placeholder="è¯·è¾“å…¥è®¿é—®å¯†ç ">
                    <div class="modal-buttons">
                        <button class="btn-confirm" onclick="verifyAccessPassword()">ç¡®è®¤</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // éªŒè¯è®¿é—®å¯†ç 
        async function verifyAccessPassword() {
            const password = document.getElementById('access-password-input').value;
            if (password === ACCESS_PASSWORD) {
                isPageAccessible = true;
                const modal = document.querySelector('.modal.active');
                if (modal) {
                    modal.remove();
                }
                await initPage(); // éªŒè¯é€šè¿‡åå¼‚æ­¥åˆå§‹åŒ–é¡µé¢
            } else {
                alert('å¯†ç é”™è¯¯');
            }
        }

        // åˆå§‹åŒ–é¡µé¢
        async function initPage() {
            await loadDocuments(); // ä½¿ç”¨å¼‚æ­¥åŠ è½½
            renderDocList();
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºå¯†ç è¾“å…¥æ¡†
        document.addEventListener('DOMContentLoaded', async function() {
            const route = parseUrl();

            // å¦‚æœæ˜¯æ–‡æ¡£é¡µé¢ç›´æ¥æ˜¾ç¤ºå†…å®¹ï¼ˆæ— éœ€å¯†ç ï¼‰
            if (route.type === 'doc') {
                await loadDocuments(); // å¼‚æ­¥åŠ è½½
                const doc = documents.find(d => d.slug === route.slug);
                if (doc) {
                    // è¿›å…¥åˆ†äº«æ¨¡å¼
                    isShareMode = true;
                    currentDocId = doc.id;
                    document.getElementById('editor-title').value = doc.title;
                    document.getElementById('editor').value = doc.content;
                    updatePreview();

                    document.getElementById('list-view').style.display = 'none';
                    document.getElementById('editor-view').style.display = 'block';
                    document.getElementById('mode-buttons').style.display = 'flex'; // æ˜¾ç¤ºæ¨¡å¼åˆ‡æ¢æŒ‰é’®
                    switchMode('preview'); // åˆ‡æ¢åˆ°é¢„è§ˆæ¨¡å¼
                    hideEditorControls(); // éšè—é¡¶éƒ¨ç¼–è¾‘æ§ä»¶
                    hideFooterControls(); // éšè—åº•éƒ¨ç¼–è¾‘æ§ä»¶
                    hideNavMenu(); // éšè—å¯¼èˆªèœå•
                } else {
                    // æ–‡æ¡£ä¸å­˜åœ¨ï¼Œæ˜¾ç¤ºé”™è¯¯é¡µé¢
                    document.body.innerHTML = `
                        <div class="doc-manager" style="display: flex; align-items: center; justify-content: center;">
                            <div class="doc-container" style="text-align: center;">
                                <h1 style="color: var(--primary-color); font-size: 2rem; margin-bottom: 1rem;">æ–‡æ¡£ä¸å­˜åœ¨</h1>
                                <p style="color: var(--secondary-color); font-size: 1.2rem;">æ‚¨è®¿é—®çš„æ–‡æ¡£ä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤</p>
                                <a href="/doc.html" style="display: inline-block; margin-top: 2rem; padding: 0.75rem 1.5rem; background: var(--accent-color); color: white; text-decoration: none; border-radius: 8px;">è¿”å›æ–‡æ¡£åˆ—è¡¨</a>
                            </div>
                        </div>
                    `;
                }
            } else {
                // æ™®é€šè®¿é—®ï¼Œéœ€è¦å¯†ç 
                showAccessPasswordModal();
            }
        });

        // ä» Supabase åŠ è½½æ–‡æ¡£ï¼ˆç»Ÿä¸€æ¥å£ï¼‰
        async function loadDocuments() {
            if (!supabase) {
                console.warn('æœªé…ç½® Supabaseï¼Œä½¿ç”¨æœ¬åœ°å­˜å‚¨');
                const stored = localStorage.getItem('weatheraintbad_documents');
                documents = stored ? JSON.parse(stored) : [];
                console.log('ä»æœ¬åœ°å­˜å‚¨åŠ è½½äº†', documents.length, 'ä¸ªæ–‡æ¡£');
                return;
            }

            try {
                const { data, error } = await supabase.from('documents').select('*');

                if (error) {
                    throw new Error(`Failed to load documents: ${error.message}`);
                }

                if (data && data.length > 0) {
                    documents = data;
                    console.log('ä» Supabase åŠ è½½äº†', documents.length, 'ä¸ªæ–‡æ¡£');
                } else {
                    console.warn('Supabase ä¸­æ²¡æœ‰æ–‡æ¡£ï¼Œåˆå§‹åŒ–ç©ºæ•°ç»„');
                    documents = [];
                }
            } catch (error) {
                console.error('ä» Supabase åŠ è½½æ–‡æ¡£å¤±è´¥:', error);
                // å¤±è´¥æ—¶å›é€€åˆ°æœ¬åœ°å­˜å‚¨
                const stored = localStorage.getItem('weatheraintbad_documents');
                documents = stored ? JSON.parse(stored) : [];
                console.log('ä»æœ¬åœ°å­˜å‚¨åŠ è½½äº†', documents.length, 'ä¸ªæ–‡æ¡£');
            }
        }

        // ä¿å­˜æ–‡æ¡£åˆ° Supabaseï¼ˆç»Ÿä¸€æ¥å£ï¼‰
        async function saveDocuments() {
            if (!supabase) {
                console.warn('æœªé…ç½® Supabaseï¼Œä½¿ç”¨æœ¬åœ°å­˜å‚¨');
                localStorage.setItem('weatheraintbad_documents', JSON.stringify(documents));
                return { success: true, message: 'æ–‡æ¡£å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨' };
            }

            try {
                // å…ˆåˆ é™¤æ‰€æœ‰ç°æœ‰æ–‡æ¡£
                await supabase.from('documents').delete();

                // å†æ’å…¥æ‰€æœ‰æ–‡æ¡£
                if (documents.length > 0) {
                    const { data, error } = await supabase.from('documents').insert(documents);

                    if (error) {
                        throw new Error(`Failed to save documents: ${error.message}`);
                    }
                }

                console.log('æ–‡æ¡£å·²ä¿å­˜åˆ° Supabase');
                // åŒæ—¶ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ä½œä¸ºå¤‡ä»½
                localStorage.setItem('weatheraintbad_documents', JSON.stringify(documents));
                return { success: true, message: 'æ–‡æ¡£å·²ä¿å­˜åˆ° Supabase' };
            } catch (error) {
                console.error('ä¿å­˜æ–‡æ¡£åˆ° Supabase å¤±è´¥:', error);
                // å¤±è´¥æ—¶å›é€€åˆ°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('weatheraintbad_documents', JSON.stringify(documents));
                return { success: false, message: `Supabase ä¿å­˜å¤±è´¥ï¼Œå·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ (${error.message})` };
            }
        }

        // æ¸²æŸ“æ–‡æ¡£åˆ—è¡¨
        function renderDocList() {
            const listContainer = document.getElementById('doc-list');
            const emptyState = document.getElementById('empty-state');

            if (documents.length === 0) {
                listContainer.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';

            listContainer.innerHTML = documents.map(doc => `
                <div class="doc-item" onclick="openDocument('${doc.id}')">
                    <div class="doc-item-title">${escapeHtml(doc.title)}</div>
                    <div class="doc-item-meta">
                        <span>${formatDate(doc.updatedAt)}</span>
                        <span>â± ${formatWordCount(doc.content)}</span>
                    </div>
                </div>
            `).join('');
        }

        // æ˜¾ç¤ºæ–°å»ºæ–‡æ¡£æ¨¡æ€æ¡†
        function showCreateModal() {
            document.getElementById('new-doc-title').value = '';
            document.getElementById('create-modal').classList.add('active');
        }

        // éšè—æ–°å»ºæ–‡æ¡£æ¨¡æ€æ¡†
        function hideCreateModal() {
            document.getElementById('create-modal').classList.remove('active');
        }

        // åˆ›å»ºæ–°æ–‡æ¡£
        function createDocument() {
            const title = document.getElementById('new-doc-title').value.trim();
            if (!title) {
                alert('è¯·è¾“å…¥æ–‡æ¡£æ ‡é¢˜');
                return;
            }

            const newDoc = {
                id: Date.now().toString(),
                title: title,
                content: '',
                slug: generateSlug(), // æ·»åŠ åˆ†äº«æ ‡è¯†ç¬¦
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };

            documents.unshift(newDoc);
            saveDocuments();
            hideCreateModal();
            openDocument(newDoc.id);
        }

        // æ‰“å¼€æ–‡æ¡£è¿›è¡Œç¼–è¾‘
        function openDocument(docId) {
            const doc = documents.find(d => d.id === docId);
            if (!doc) return;

            currentDocId = docId;
            document.getElementById('editor-title').value = doc.title;
            document.getElementById('editor').value = doc.content;
            updatePreview();

            document.getElementById('list-view').style.display = 'none';
            document.getElementById('editor-view').style.display = 'block';
            // æ˜¾ç¤ºå¯¼èˆªæ ä¸­çš„æ¨¡å¼åˆ‡æ¢æŒ‰é’®
            document.getElementById('mode-buttons').style.display = 'flex';
        }

        // è¿”å›æ–‡æ¡£åˆ—è¡¨
        function goBackToList() {
            currentDocId = null;
            document.getElementById('editor-view').style.display = 'none';
            document.getElementById('list-view').style.display = 'block';
            renderDocList();
            // éšè—å¯¼èˆªæ ä¸­çš„æ¨¡å¼åˆ‡æ¢æŒ‰é’®
            document.getElementById('mode-buttons').style.display = 'none';
        }

        // åˆ‡æ¢ç¼–è¾‘/é¢„è§ˆæ¨¡å¼
        function switchMode(mode) {
            const modeBtns = document.querySelectorAll('.mode-btn');
            modeBtns.forEach(btn => btn.classList.remove('active'));

            if (mode === 'edit') {
                document.querySelector('.edit-btn').classList.add('active');
                document.getElementById('editor').style.display = 'block';
                document.getElementById('preview').style.display = 'none';
            } else {
                document.querySelector('.preview-btn').classList.add('active');
                updatePreview();
                document.getElementById('editor').style.display = 'none';
                document.getElementById('preview').style.display = 'block';
            }
        }

        // æ›´æ–°é¢„è§ˆ
        function updatePreview() {
            const content = document.getElementById('editor').value;
            const preview = document.getElementById('preview');
            preview.innerHTML = marked.parse(content) || '<p style="color: var(--secondary-color); opacity: 0.5;">æš‚æ— å†…å®¹</p>';
        }

        // åˆ é™¤æ–‡æ¡£
        function deleteDocument() {
            if (!currentDocId) return;

            if (confirm('ç¡®å®šè¦åˆ é™¤å½“å‰æ–‡æ¡£å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                documents = documents.filter(doc => doc.id !== currentDocId);
                saveDocuments();
                goBackToList();
                alert('æ–‡æ¡£åˆ é™¤æˆåŠŸ');
            }
        }

        // åˆ†äº«æ¨¡å¼çŠ¶æ€
        let isShareMode = false;
        const SHARE_PASSWORD = atob('MTQ3ODk2MzI1');

        // åˆ‡æ¢åˆ†äº«æ¨¡å¼
        function toggleShareMode() {
            if (!isShareMode) {
                // è¿›å…¥åˆ†äº«æ¨¡å¼
                const shareUrl = generateShareUrl(currentDocId);
                // æ˜¾ç¤ºåˆ†äº«é“¾æ¥
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.innerHTML = `
                    <div class="modal-content">
                        <div class="modal-title">åˆ†äº«æ–‡æ¡£</div>
                        <p style="color: var(--secondary-color); margin-bottom: 1rem;">å¤åˆ¶ä»¥ä¸‹é“¾æ¥åˆ†äº«ç»™ä»–äººï¼š</p>
                        <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                            <input type="text" id="share-url" class="modal-input" value="${shareUrl}" readonly style="flex: 1;">
                            <button class="btn-confirm" onclick="copyShareUrl()">å¤åˆ¶</button>
                        </div>
                        <div class="modal-buttons">
                            <button class="btn-cancel" onclick="hideShareModal()">å…³é—­</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            } else {
                // é€€å‡ºåˆ†äº«æ¨¡å¼
                showEditorControls(); // æ˜¾ç¤ºé¡¶éƒ¨ç¼–è¾‘æ§ä»¶
                showFooterControls(); // æ˜¾ç¤ºåº•éƒ¨ç¼–è¾‘æ§ä»¶
                showNavMenu(); // æ˜¾ç¤ºå¯¼èˆªèœå•
                isShareMode = false;
            }
        }

        // éšè—åˆ†äº«æ¨¡æ€æ¡†
        function hideShareModal() {
            const modal = document.querySelector('.modal.active');
            if (modal) {
                modal.remove();
            }
        }

        // å¤åˆ¶åˆ†äº«é“¾æ¥
        function copyShareUrl() {
            const shareUrlInput = document.getElementById('share-url');

            // ä½¿ç”¨ç°ä»£çš„ Clipboard API
            if (navigator.clipboard && window.isSecureContext) {
                // ç°ä»£æµè§ˆå™¨æ”¯æŒçš„æ–¹å¼
                navigator.clipboard.writeText(shareUrlInput.value).then(() => {
                    alert('åˆ†äº«é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                }).catch(err => {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                    fallbackCopy(shareUrlInput);
                });
            } else {
                // æ—§æµè§ˆå™¨çš„ fallback æ–¹å¼
                fallbackCopy(shareUrlInput);
            }
        }

        // æ—§æµè§ˆå™¨çš„å¤åˆ¶æ–¹æ³•
        function fallbackCopy(inputElement) {
            try {
                inputElement.select();
                const successful = document.execCommand('copy');
                if (successful) {
                    alert('åˆ†äº«é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                } else {
                    alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¹¶å¤åˆ¶é“¾æ¥');
                }
            } catch (err) {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¹¶å¤åˆ¶é“¾æ¥');
            }
        }

        // éšè—åº•éƒ¨ç¼–è¾‘æ§ä»¶
        function hideFooterControls() {
            document.querySelectorAll('.btn-delete, .btn-share, .btn-save').forEach(btn => {
                btn.style.display = 'none';
            });
        }

        // æ˜¾ç¤ºåº•éƒ¨ç¼–è¾‘æ§ä»¶
        function showFooterControls() {
            document.querySelectorAll('.btn-delete, .btn-share, .btn-save').forEach(btn => {
                btn.style.display = 'block';
            });
        }

        // éšè—ç¼–è¾‘æ§ä»¶
        function hideEditorControls() {
            document.querySelectorAll('.btn-back, .btn-delete, .btn-save').forEach(btn => {
                btn.style.display = 'none';
            });
        }

        // æ˜¾ç¤ºç¼–è¾‘æ§ä»¶
        function showEditorControls() {
            document.querySelectorAll('.btn-back, .btn-delete, .btn-save').forEach(btn => {
                btn.style.display = 'block';
            });
        }

        // éšè—å¯¼èˆªèœå•
        function hideNavMenu() {
            document.querySelector('.nav-menu').style.display = 'none';
        }

        // æ˜¾ç¤ºå¯¼èˆªèœå•
        function showNavMenu() {
            document.querySelector('.nav-menu').style.display = 'flex';
        }

        // å¯†ç éªŒè¯æ¨¡æ€æ¡†
        function showPasswordModal() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-title">ç¼–è¾‘å¯†ç </div>
                    <input type="password" id="password-input" class="modal-input" placeholder="è¯·è¾“å…¥ç¼–è¾‘å¯†ç ">
                    <div class="modal-buttons">
                        <button class="btn-cancel" onclick="hidePasswordModal()">å–æ¶ˆ</button>
                        <button class="btn-confirm" onclick="verifyPassword()">ç¡®è®¤</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // éšè—å¯†ç éªŒè¯æ¨¡æ€æ¡†
        function hidePasswordModal() {
            const modal = document.querySelector('.modal.active');
            if (modal) {
                modal.remove();
            }
        }

        // éªŒè¯å¯†ç 
        function verifyPassword() {
            const password = document.getElementById('password-input').value;
            if (password === SHARE_PASSWORD) {
                hidePasswordModal();
                toggleShareMode(); // é€€å‡ºåˆ†äº«æ¨¡å¼
            } else {
                alert('å¯†ç é”™è¯¯');
            }
        }

        // é‡å†™ switchMode å‡½æ•°ï¼Œåœ¨åˆ†äº«æ¨¡å¼ä¸‹ç‚¹å‡»ç¼–è¾‘æŒ‰é’®æ—¶æ˜¾ç¤ºå¯†ç è¾“å…¥æ¡†
        function switchMode(mode) {
            // å¦‚æœæ˜¯åˆ†äº«æ¨¡å¼ä¸”ç‚¹å‡»çš„æ˜¯ç¼–è¾‘æŒ‰é’®
            if (isShareMode && mode === 'edit') {
                showPasswordModal();
                return;
            }

            const modeBtns = document.querySelectorAll('.mode-btn');
            modeBtns.forEach(btn => btn.classList.remove('active'));

            if (mode === 'edit') {
                document.querySelector('.edit-btn').classList.add('active');
                document.getElementById('editor').style.display = 'block';
                document.getElementById('preview').style.display = 'none';
            } else {
                document.querySelector('.preview-btn').classList.add('active');
                updatePreview();
                document.getElementById('editor').style.display = 'none';
                document.getElementById('preview').style.display = 'block';
            }
        }

        // ä¿å­˜æ–‡æ¡£
        async function saveDocument() {
            if (!currentDocId) return;

            const doc = documents.find(d => d.id === currentDocId);
            if (!doc) return;

            doc.title = document.getElementById('editor-title').value.trim() || 'æœªå‘½åæ–‡æ¡£';
            doc.content = document.getElementById('editor').value;
            doc.updatedAt = new Date().toISOString();

            const result = await saveDocuments();
            alert(result.message);
        }

        // å·¥å…·å‡½æ•°
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };

            return text.replace(/[&<>"]/g, function(m) { return map[m]; });
        }

        function formatDate(isoString) {
            const date = new Date(isoString);
            const now = new Date();
            const diff = now - date;

            if (diff < 60000) { // å°äº1åˆ†é’Ÿ
                return 'åˆšåˆš';
            } else if (diff < 3600000) { // å°äº1å°æ—¶
                return Math.floor(diff / 60000) + 'åˆ†é’Ÿå‰';
            } else if (diff < 86400000) { // å°äº1å¤©
                return Math.floor(diff / 3600000) + 'å°æ—¶å‰';
            } else {
                return date.toLocaleDateString('zh-CN');
            }
        }

        function formatWordCount(content) {
            if (!content) return '0';
            const count = content.trim().split(/\s+/).filter(word => word.length > 0).length;
            return count + (count === 1 ? 'å­—' : 'å­—');
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    </script>
</body>
</html>